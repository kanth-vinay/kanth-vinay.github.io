<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 7 — Exponential & Logarithmic Functions + Derivatives — Prof. Kodipelly</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Reveal core -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/theme/white.min.css" id="theme-link">

  <!-- Menu plugin -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.css">

  <style>
    :root{
      --brand-primary:#1A237E; --brand-secondary:#303F9F;
      --accent-green:#16A34A; --accent-sky:#0288D1; --accent-gold:#FBC02D;
      --text-primary:#111827; --text-secondary:#4B5563;
      --bg-primary:#FFFFFF; --bg-secondary:#F3F4F6; --border-color:#D1D5DB;
      --shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    [data-theme="dark"]{
      --brand-primary:#5C6BC0; --brand-secondary:#7986CB;
      --accent-green:#4CAF50; --accent-sky:#29B6F6; --accent-gold:#FFCA28;
      --text-primary:#F9FAFB; --text-secondary:#9CA3AF;
      --bg-primary:#111827; --bg-secondary:#1F2937; --border-color:#374151;
    }

    body{ font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
          color:var(--text-primary); background:var(--bg-primary);
          transition:background-color .3s,color .3s; }

    /* Fixed chrome */
    #page-header,#page-footer{ position:fixed; left:0; right:0; z-index:1000;
      background:var(--brand-primary); color:#fff; display:flex; align-items:center; justify-content:space-between;
      padding:0 20px; box-shadow:var(--shadow-md); letter-spacing:.2px; }
    #page-header{ top:0; height:64px; }
    #page-footer{ bottom:0; height:40px; font-size:.85em; }
    #page-header .author{ font-weight:800; font-size:1.1em; }
    #page-header .topic{ font-weight:600; opacity:.95; }
    #page-header .controls{ display:flex; gap:12px; align-items:center; }
    #page-footer .hints{ opacity:.85; }

    .theme-toggle{ background:none; border:1px solid rgba(255,255,255,.35); color:#fff; border-radius:999px;
      padding:6px 10px; cursor:pointer; font-weight:600; }
    .theme-toggle:focus{ outline:2px solid #fff2; outline-offset:2px; }

    /* Content area avoids chrome */
    .reveal{ margin-top:64px; margin-bottom:40px; font-size:28px; }
    .reveal .slides{ color:var(--text-primary); }
    [data-theme="dark"] .reveal .slides{ color:var(--text-primary); }
    
    /* FIX: Vertically center slide content using Flexbox. */
    .reveal .slides section{
      display: flex;
      flex-direction: column;
      justify-content: center; /* This is the key change */
      height: 100%;
      padding: 1vh 0;
    }

    .reveal h2,.reveal h3{ color:var(--brand-secondary); letter-spacing:-.3px; }
    .reveal h2{ font-size:1.6em; margin-bottom:18px; }
    .reveal h3{ font-size:1.1em; font-weight:600; opacity:.95; }
    .reveal p,.reveal li{ line-height:1.5; }

    /* Utilities */
    .left-align{ text-align:left; max-width:900px; margin:0 auto; }
    .small-text{ font-size:.8em; opacity:.9; }
    .muted{ color:var(--text-secondary); }

    /* Pills */
    .pill-row{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:10px; }
    .pill{ background:var(--brand-secondary); color:#fff; padding:8px 14px; border-radius:999px; font-weight:600; font-size:.75em; box-shadow:var(--shadow-sm); }

    /* Callout */
    .callout{ border-left:4px solid var(--accent-green); background:var(--bg-secondary);
      padding:14px 18px; border-radius:8px; border:1px solid var(--border-color); margin:1em 0; }

    /* Math steps */
    .math-steps{ display:flex; flex-direction:column; gap:10px; }
    .step{ padding:12px 16px; border-radius:8px; border:1px solid var(--border-color); background:var(--bg-primary); box-shadow:var(--shadow-sm); }

    /* Flip card */
    .card{ perspective:1200px; width:min(860px,90vw); margin:16px auto; }
    .card[role="button"]{ cursor:pointer; }
    .card-inner{ position:relative; width:100%; min-height:160px; transition:transform .6s; transform-style:preserve-3d; }
    .card.flipped .card-inner{ transform:rotateY(180deg); }
    .card-face{ position:absolute; inset:0; display:flex; flex-direction: column; align-items:center; justify-content:center;
      backface-visibility:hidden; border-radius:10px; border:1px solid var(--border-color);
      padding:20px; background:var(--bg-primary); box-shadow:var(--shadow-md); text-align:center; }
    .card-face.front{ background:var(--bg-secondary); }
    .card-face.back{ transform:rotateY(180deg); }

    /* Polls */
    .poll{ display:flex; flex-direction:column; gap:14px; align-items:center; }
    .poll .choices{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .poll button{ padding:10px 16px; border-radius:999px; border:1px solid var(--border-color); background:var(--bg-primary); font-weight:700; cursor:pointer; }
    .poll .results{ width:min(860px,90vw); display:grid; gap:6px; font-size:.9em; }
    .bar{ height:20px; background:var(--bg-secondary); border-radius:6px; overflow:hidden; border:1px solid var(--border-color); }
    .bar>span{ display:block; height:100%; width:0%; background-image:linear-gradient(45deg,var(--accent-sky),var(--brand-secondary)); transition:width .4s ease; }
    .poll [aria-live]{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }

    /* Canvas tool */
    #derivative-canvas{ width:720px; height:420px; max-width:95vw; border:1px solid var(--border-color); border-radius:8px; background:var(--bg-primary); }
    #tool-output{ background:var(--bg-secondary); padding:10px 14px; border-radius:8px; font-family:monospace; font-size:1.05em; min-width:300px; text-align:center; }
    #tool-controls{ display:flex; align-items:center; gap:16px; flex-wrap:wrap; justify-content:center; font-size:.9em; }
    #tool-controls label{ display:flex; align-items:center; gap:6px; }
  </style>
</head>
<body>

  <!-- Fixed chrome -->
  <header id="page-header" role="banner" aria-label="Deck header">
    <div class="author">Prof. Vinay Kanth Rao Kodipelly</div>
    <div class="topic" id="topic-slot">Week 7</div>
    <div class="controls">
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle light/dark">Theme</button>
    </div>
  </header>
  <footer id="page-footer" role="contentinfo" aria-label="Deck footer">
    <div class="brand">University of Missouri–St. Louis</div>
    <div class="hints">←/→ • ↓/↑ • F • S</div>
  </footer>

  <div class="reveal">
    <div class="slides">
      <!-- Title -->
      <section data-menu="title" data-topic="Week 7 — Exp & Log Functions">
        <h2>Exponential & Logarithmic Functions + Derivatives</h2>
        <h3 class="muted">Natural base \(e\), properties of \(\ln x\), and \(\dfrac{d}{dx}\big(e^{f(x)}\big)\)</h3>
        <div class="pill-row"><div class="pill">Objectives</div><div class="pill">Examples</div><div class="pill">Quick Checks</div><div class="pill">Applications</div></div>
      </section>

      <!-- 2.1 Objectives -->
      <section data-menu="objectives-21" data-topic="Unit 2.1 Objectives">
        <h2>Unit 2.1 — Objectives</h2>
        <div class="left-align">
          <ul>
            <li>Use \(e\) and model continuous growth \(A=Pe^{rt}\).</li>
            <li>Treat \(\ln x\) as inverse of \(e^x\); apply log properties.</li>
            <li>Find domains; solve exponential/log equations.</li>
          </ul>
        </div>
        <div class="callout small-text"><strong>Inverse Pair:</strong> \(\ln(e^x)=x\), \(e^{\ln x}=x\) for \(x&gt;0\).</div>
      </section>

      <!-- Example 1: Continuous growth -->
      <section data-menu="ex-21-1" data-topic="Ex: Continuous Growth">
        <h2>Example — Continuous Growth</h2>
        <div class="left-align">
          <p>Luis invests \(P=\$5000\) at \(r=3.25\%\) continuously for \(t=5\) years.</p>
          <div class="math-steps">
            <div class="step fragment">\(A=5000\,e^{0.0325\cdot 5}\)</div>
            <div class="step fragment">\(A\approx 5000\,e^{0.1625}\)</div>
            <div class="step fragment">\(A\approx \boxed{\$5882.24}\)</div>
          </div>
        </div>
      </section>

      <!-- Example 2: Evaluate logs (Try It poll + reveal) -->
      <section data-menu="ex-21-2" data-topic="Evaluate Logs">
        <h2>Evaluate Logs — Try It</h2>
        <div class="left-align">
          <ol>
            <li>\(\ln(e^4)=\ ?\)</li>
            <li>\(\ln 1=\ ?\)</li>
            <li>\(\ln(e^{-1})=\ ?\)</li>
            <li>\(\ln 20\approx\ ?\) (3 d.p.)</li>
          </ol>
        </div>
        <div class="poll" data-poll-id="ex21-2" role="group" aria-label="Evaluate logs choices">
          <div class="choices">
            <button data-choice="A">A) \(4,\ 0,\ -1,\ 2.996\)</button>
            <button data-choice="B">B) \(4,\ 1,\ -1,\ 3.000\)</button>
            <button data-choice="C">C) \(e^4,\ 0,\ -1,\ 3.219\)</button>
          </div>
          <div class="results">
            <div>A) <div class="bar"><span data-bar="A"></span></div></div>
            <div>B) <div class="bar"><span data-bar="B"></span></div></div>
            <div>C) <div class="bar"><span data-bar="C"></span></div></div>
          </div>
          <div aria-live="polite" class="sr-live"></div>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal answers">
          <div class="card-inner">
            <div class="card-face front"><strong>Click / Enter to Reveal Answers</strong></div>
            <div class="card-face back">Correct: \(4,\ 0,\ -1,\ \approx 2.996\)</div>
          </div>
        </div>
      </section>

      <!-- Example 3: Use ln properties -->
      <section data-menu="ex-21-3" data-topic="Use ln Properties">
        <h2>Use \(\ln\) Properties</h2>
        <div class="left-align">
          <p>Given \(\ln2=0.6931\), \(\ln3=1.0986\), compute:</p>
          <ol>
            <li>\(\ln 6\)</li>
            <li>\(\ln 81\)</li>
            <li>\(\ln(1/3)\)</li>
            <li>\(\ln(2e^5)\)</li>
            <li>\(\log_2 3\)</li>
          </ol>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal results">
          <div class="card-inner">
            <div class="card-face front">Reveal results</div>
            <div class="card-face back">\(1.7917,\ 4.3944,\ -1.0986,\ 5.6931,\ \approx 1.5851\)</div>
          </div>
        </div>
      </section>

      <!-- Example 4: Domain -->
      <section data-menu="ex-21-4" data-topic="Domain of ln">
        <h2>Domain — \(\ln(5-2x)\)</h2>
        <div class="left-align">
          <div class="math-steps">
            <div class="step">Require \(5-2x&gt;0\)</div>
            <div class="step">\(-2x&gt;-5 \Rightarrow x&lt;\dfrac{5}{2}\)</div>
            <div class="step">Domain: \((-\infty,2.5)\)</div>
          </div>
        </div>
      </section>

      <!-- Example 5: Solve exponentials/logs -->
      <section data-menu="ex-21-5" data-topic="Solve Exp/Log">
        <h2>Solve Exponential / Log Equations</h2>
        <div class="left-align">
          <ol>
            <li>\(e^{3x}=2 \Rightarrow x=\dfrac{\ln 2}{3}\approx 0.231\)</li>
            <li>\(250\,e^{0.015t}=750 \Rightarrow t=\dfrac{\ln 3}{0.015}\approx 73.24\)</li>
          </ol>
        </div>
      </section>

      <!-- Example 6: Doubling time -->
      <section data-menu="ex-21-6" data-topic="Doubling Time">
        <h2>Doubling Time & Growth Rate</h2>
        <div class="callout left-align">
          \(rT=\ln2\ \Rightarrow\ r=\dfrac{\ln2}{T},\ \ T=\dfrac{\ln2}{r}\).
          <div class="small-text">Example: doubling every 6 months \(\Rightarrow r\approx 0.116\) per month (11.6%).</div>
        </div>
      </section>

      <!-- Example 7: Solve a log equation -->
      <section data-menu="ex-21-7" data-topic="Solve a Log Equation">
        <h2>Solve a Log Equation</h2>
        <div class="left-align">
          <p>\(5+7\ln(x+3)=19\)</p>
          <div class="card" tabindex="0" role="button" aria-label="Reveal steps">
            <div class="card-inner">
              <div class="card-face front">Reveal steps & solution</div>
              <div class="card-face back">\(\ln(x+3)=2 \Rightarrow x=e^2-3\approx 4.389\)</div>
            </div>
          </div>
        </div>
      </section>

      <!-- QC1 (2.1) -->
      <section data-menu="qc-21-1" data-topic="Quick Check (2.1)">
        <h2>Quick Check — Continuous Compounding</h2>
        <p>\(P=\$20{,}000,\ r=4\%,\ t=3\) (continuous). What is \(A\)?</p>
        <div class="poll" data-poll-id="qc21-1" role="group" aria-label="QC: continuous compounding">
          <div class="choices">
            <button data-choice="A">A) \$22,400.00</button>
            <button data-choice="B">B) \$22,549.94</button>
            <button data-choice="C">C) \$22,497.31</button>
          </div>
          <div class="results">
            <div>A) <div class="bar"><span data-bar="A"></span></div></div>
            <div>B) <div class="bar"><span data-bar="B"></span></div></div>
            <div>C) <div class="bar"><span data-bar="C"></span></div></div>
          </div>
          <div aria-live="polite" class="sr-live"></div>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal solution">
          <div class="card-inner">
            <div class="card-face front">Reveal solution</div>
            <div class="card-face back">\(A=20000\,e^{0.04\cdot3}\approx \mathbf{\$22{,}549.94}\)</div>
          </div>
        </div>
      </section>

      <!-- QC2 (2.1) -->
      <section data-menu="qc-21-2" data-topic="Quick Check (2.1)">
        <h2>Quick Check — Domain</h2>
        <p>Domain of \(f(x)=\ln(7-3x)\):</p>
        <div class="poll" data-poll-id="qc21-2" role="group" aria-label="QC: domain of ln(7-3x)">
          <div class="choices">
            <button data-choice="A">A) \(x&gt;\dfrac{7}{3}\)</button>
            <button data-choice="B">B) \(x&lt;\dfrac{7}{3}\)</button>
            <button data-choice="C">C) all real \(x\)</button>
          </div>
          <div class="results">
            <div>A) <div class="bar"><span data-bar="A"></span></div></div>
            <div>B) <div class="bar"><span data-bar="B"></span></div></div>
            <div>C) <div class="bar"><span data-bar="C"></span></div></div>
          </div>
          <div aria-live="polite" class="sr-live"></div>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal domain">
          <div class="card-inner">
            <div class="card-face front">Reveal</div>
            <div class="card-face back">Require \(7-3x&gt;0 \Rightarrow x&lt;\dfrac{7}{3}\).</div>
          </div>
        </div>
      </section>

      <!-- 2.2 Objectives -->
      <section data-menu="objectives-22" data-topic="Unit 2.2 Objectives">
        <h2>Unit 2.2 — Derivatives of \(e^x\)</h2>
        <div class="callout left-align">
          <ul>
            <li>Differentiate \(e^x\) and \(e^{f(x)}\).</li>
            <li>Use product/quotient/chain with exponentials.</li>
            <li>Interpret \(A'(t)\) for \(A(t)=Pe^{rt}\).</li>
          </ul>
        </div>
      </section>

      <!-- Derivative rules -->
      <section data-menu="rules" data-topic="Derivative Rules">
        <h2>Core Rules for Exponentials</h2>
        <div class="math-steps left-align">
          <div class="step">\(\dfrac{d}{dx}(e^x)=e^x\)</div>
          <div class="step">\(\dfrac{d}{dx}\big(e^{f(x)}\big)=e^{f(x)}\,f'(x)\)</div>
        </div>
      </section>

      <!-- 2.2 Worked Ex 1 -->
      <section data-menu="ex-22-1" data-topic="Differentiate (basics)">
        <h2>Differentiate — Basics</h2>
        <div class="left-align">
          <ol>
            <li>\(y=3e^x\)</li>
            <li>\(y=x^2e^x\)</li>
            <li>\(y=\dfrac{e^x}{x^3}\)</li>
          </ol>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal derivatives">
          <div class="card-inner">
            <div class="card-face front">Reveal derivatives</div>
            <div class="card-face back">
              \(y'=3e^x;\ \ y'=x^2e^x+2xe^x=e^x(x^2+2x);\ \ y'=\dfrac{e^x(x-3)}{x^4}\).
            </div>
          </div>
        </div>
      </section>

      <!-- 2.2 Worked Ex 3 -->
      <section data-menu="ex-22-3" data-topic="Differentiate (chain)">
        <h2>Differentiate — Chain Rule</h2>
        <div class="left-align">
          <ol>
            <li>\(y=e^{8x}\)</li>
            <li>\(y=e^{\,2x^2-4x+7}\)</li>
            <li>\(y=e^{\,3/x^2}\)</li>
          </ol>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal derivatives">
          <div class="card-inner">
            <div class="card-face front">Reveal derivatives</div>
            <div class="card-face back">
              \(y'=8e^{8x};\ \ y'=(4x-4)e^{\,2x^2-4x+7};\ \ y'=-\dfrac{6}{x^3}e^{3/x^2}.\)
            </div>
          </div>
        </div>
      </section>

      <!-- 2.2 Worked Ex 4: second derivative -->
      <section data-menu="ex-22-4" data-topic="Second Derivative">
        <h2>Second Derivative</h2>
        <div class="left-align">
          <p>For \(y=e^{-5x^2}\), find \(y''\).</p>
          <div class="math-steps">
            <div class="step">\(y'=(-10x)e^{-5x^2}\)</div>
            <div class="step">\(y''=(-10)e^{-5x^2}+(-10x)(-10x)e^{-5x^2}\)</div>
            <div class="step">\(\boxed{y''=(100x^2-10)e^{-5x^2}}\)</div>
          </div>
        </div>
      </section>

      <!-- 2.2 Worked Ex 5: applied rates -->
      <section data-menu="ex-22-5" data-topic="Applied Rates">
        <h2>Applied Rates</h2>
        <div class="left-align">
          <p>\(A(t)=50{,}000\,e^{0.0125t}\). Find \(A(5)\) and \(A'(5)\); interpret \(A'(5)\).</p>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal results">
          <div class="card-inner">
            <div class="card-face front">Reveal results</div>
            <div class="card-face back">
              \(A(5)\approx \$53{,}224.72,\quad A'(t)=0.0125\,A(t)\Rightarrow A'(5)\approx \$665.31\) per year.
            </div>
          </div>
        </div>
      </section>

      <!-- 2.2 Quick Checks -->
      <section data-menu="qc-22-1" data-topic="QC — Prod/Quotient">
        <h2>Quick Check — Product / Quotient</h2>
        <div class="left-align">
          <ol>
            <li>\(y=6e^x\)</li>
            <li>\(y=3x\,e^x\)</li>
            <li>\(y=\dfrac{e^x}{x^2}\)</li>
          </ol>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal derivatives">
          <div class="card-inner">
            <div class="card-face front">Reveal derivatives</div>
            <div class="card-face back">
              \(6e^x;\ \ 3e^x+3xe^x;\ \ \dfrac{e^x(x-2)}{x^3}\).
            </div>
          </div>
        </div>
      </section>

      <section data-menu="qc-22-3" data-topic="QC — Chain Rule">
        <h2>Quick Check — Chain Rule</h2>
        <div class="left-align">
          <ol>
            <li>\(f(x)=e^{-4x}\)</li>
            <li>\(g(x)=e^{\,x^3+8x}\)</li>
            <li>\(h(x)=e^{\,(x^2+5)/x}\)</li>
          </ol>
        </div>
        <div class="poll" data-poll-id="qc22-3a" role="group" aria-label="QC: derivative of e^{-4x}">
          <p>Pick \(f'(x)\)</p>
          <div class="choices">
            <button data-choice="A">A) \(e^{-4x}\)</button>
            <button data-choice="B">B) \(-4e^{-4x}\)</button>
            <button data-choice="C">C) \(4e^{-4x}\)</button>
          </div>
          <div class="results">
            <div>A) <div class="bar"><span data-bar="A"></span></div></div>
            <div>B) <div class="bar"><span data-bar="B"></span></div></div>
            <div>C) <div class="bar"><span data-bar="C"></span></div></div>
          </div>
          <div aria-live="polite" class="sr-live"></div>
        </div>
        <div class="card" tabindex="0" role="button" aria-label="Reveal full QC answers">
          <div class="card-inner">
            <div class="card-face front">Reveal all QC answers</div>
            <div class="card-face back">
              \(f'(x)=-4e^{-4x};\ \ g'(x)=(3x^2+8)e^{\,x^3+8x};\ \ h'(x)=e^{\,(x^2+5)/x}\cdot\left(1-\dfrac{5}{x^2}\right).\)
            </div>
          </div>
        </div>
      </section>

      <!-- Interactive tool -->
      <section id="derivative-tool-slide" data-menu="tool" data-topic="Derivative Explorer">
        <h2>Interactive Derivative Explorer</h2>
        <div id="tool-controls">
          <label><input type="radio" name="func" value="ex" checked> \(y=e^x\)</label>
          <label><input type="radio" name="func" value="lnx"> \(y=\ln x\)</label>
          <label for="x-slider" class="muted">x = <span id="x-val-display">1.00</span></label>
          <input type="range" id="x-slider" min="0.1" max="3" value="1" step="0.01" style="width:260px" aria-label="Choose x">
        </div>
        <canvas id="derivative-canvas" aria-label="Function with tangent"></canvas>
        <div id="tool-output" aria-live="polite">At x=<span class="x-val">1.00</span>: y=<span id="y-val">…</span>, slope(y′)=<span id="yp-val">…</span></div>
        <p class="small-text muted">Tip: switch to \(\ln x\) and slide near \(x=0.2\) to see how steep the tangent becomes.</p>
      </section>

      <!-- Key Facts -->
      <section data-menu="key-facts" data-topic="Key Facts">
        <h2>Key Facts</h2>
        <div class="left-align">
          <ul>
            <li>Continuous Compounding: \(A=Pe^{rt}\)</li>
            <li>Change of Base: \(\log_b a=\dfrac{\ln a}{\ln b}\)</li>
            <li>Inverse Pair: \(\ln(e^x)=x,\ e^{\ln x}=x\ (x&gt;0)\)</li>
            <li>Derivative Rules: \(\dfrac{d}{dx}(e^x)=e^x,\ \dfrac{d}{dx}\big(e^{f(x)}\big)=e^{f(x)}f'(x)\)</li>
          </ul>
        </div>
      </section>
    </div>
  </div>

  <!-- Reveal & plugins -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.js"></script>

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: { inlineMath:[['\\(','\\)']], displayMath:[['\\[','\\]']] },
      svg: { fontCache:'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <script>
    // Initialize Reveal.js deck
    const deck = new Reveal({
      hash:true, slideNumber:'c/t', navigationMode:'default',
      transition:'fade', width:1280, height:720, margin:0.04,
      plugins:[RevealMenu]
    });
    deck.initialize();

    // --- Core UI Management ---

    function updateHeaderTopic(){
      const el = document.getElementById('topic-slot');
      if (!el) return;
      const s = deck.getCurrentSlide();
      el.textContent = (s && s.dataset && s.dataset.topic) ? s.dataset.topic : 'Week 7';
    }

    function setupThemeToggle(){
      const btn = document.getElementById('theme-toggle');
      if (!btn) return;
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
      let theme = localStorage.getItem('slides-theme') || (prefersDark.matches ? 'dark' : 'light');
      document.body.setAttribute('data-theme', theme);
      btn.addEventListener('click', () => {
        theme = (document.body.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
        document.body.setAttribute('data-theme', theme);
        localStorage.setItem('slides-theme', theme);
      });
    }

    // --- Interactive Elements ---

    function renderPollResults(poll){
      const id = poll.dataset.pollId; if (!id) return;
      const votes = JSON.parse(localStorage.getItem('slides-poll-'+id) || '{}');
      const counts = {A:0,B:0,C:0,D:0, ...votes};
      const total = Object.values(counts).reduce((a,b)=>a+b,0);
      poll.querySelectorAll('.results .bar > span').forEach(bar=>{
        const k = bar.dataset.bar; bar.style.width = total ? ((counts[k]||0)/total*100)+'%' : '0%';
      });
      const live = poll.querySelector('.sr-live');
      if (live) live.textContent = total ? `Votes ${total}. Leading: ${Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0]}` : 'No votes yet.';
    }
    
    // FIX: This function now correctly handles event delegation for cards and polls.
    function setupDeckInteractions(){
      document.body.addEventListener('click', (e)=>{
        // Handler for flip cards
        const card = e.target.closest('.card[role="button"]');
        if (card){ 
          card.classList.toggle('flipped'); 
        }

        // Handler for poll buttons
        const btn = e.target.closest('.poll button[data-choice]');
        if (btn){
          const poll = btn.closest('.poll');
          const id = poll.dataset.pollId;
          const choice = btn.dataset.choice;
          if (!id || !choice) return;
          
          const votes = JSON.parse(localStorage.getItem('slides-poll-'+id) || '{}');
          votes[choice] = (votes[choice]||0) + 1;
          localStorage.setItem('slides-poll-'+id, JSON.stringify(votes));
          renderPollResults(poll);
        }
      });
      
      // Keyboard accessibility for cards
      document.body.addEventListener('keydown', (e)=>{
        if ((e.key==='Enter' || e.key===' ') && document.activeElement.matches('.card[role="button"]')){
          e.preventDefault(); 
          document.activeElement.classList.toggle('flipped');
        }
      });
    }

    // --- Derivative Explorer Tool ---
    
    let isToolInitialized = false;
    function setupDerivativeTool(){
      const slide = document.getElementById('derivative-tool-slide');
      if (!slide) return;
      const canvas = document.getElementById('derivative-canvas');
      if (!canvas) return;
      
      const slider = document.getElementById('x-slider');
      const radios = slide.querySelectorAll('input[name="func"]');
      const xDisp = document.getElementById('x-val-display');
      const outX = slide.querySelector('#tool-output .x-val');
      const outY = document.getElementById('y-val');
      const outYp = document.getElementById('yp-val');

      const funcs = {
        ex:{ f:Math.exp, df:Math.exp, domain:[-2,3], range:[-1,21] },
        lnx:{ f:Math.log, df:x=>1/x, domain:[0.01,5], range:[-2,2] }
      };
      let mode = 'ex';
      let x = 1;

      function updateState(){
          mode = slide.querySelector('input[name="func"]:checked')?.value || 'ex';
          x = parseFloat(slider.value);
      }

      function setSliderConfig(){
        const isLn = (mode==='lnx');
        slider.min = isLn ? '0.1' : '-2';
        slider.max = isLn ? '5'   : '3';
        slider.step= '0.01';
        if (isLn && parseFloat(slider.value) < 0.1) slider.value = '1';
        updateState();
      }

      function worldToScreen(cx, cy, domain, range, w, h){
        const sx = (cx - domain[0])/(domain[1]-domain[0]) * w;
        const sy = h - (cy - range[0])/(range[1]-range[0]) * h;
        return [sx,sy];
      }

      function draw(){
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        const w = canvas.clientWidth, h = canvas.clientHeight;
        canvas.width = w * ratio; canvas.height = h * ratio;
        const ctx = canvas.getContext('2d');
        ctx.scale(ratio, ratio);
        
        const { domain, range, f, df } = funcs[mode];
        ctx.clearRect(0,0,w,h);

        const [ox, oy] = worldToScreen(0,0,domain,range,w,h);
        ctx.strokeStyle = '#ccc'; ctx.lineWidth = 0.5;
        ctx.beginPath();
        if (oy>=0 && oy<=h){ ctx.moveTo(0,oy); ctx.lineTo(w,oy); }
        if (ox>=0 && ox<=w){ ctx.moveTo(ox,0); ctx.lineTo(ox,h); }
        ctx.stroke();

        ctx.beginPath();
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--brand-secondary');
        ctx.lineWidth = 1.5;
        for (let i = 0; i < w; i++){
          const t = domain[0] + (i/w)*(domain[1]-domain[0]);
          if (mode==='lnx' && t <= 0) continue;
          const [sx, sy] = worldToScreen(t, f(t), domain, range, w, h);
          if (i === 0) ctx.moveTo(sx, sy); else ctx.lineTo(sx, sy);
        }
        ctx.stroke();

        const y = f(x); const m = df(x);
        const [px,py] = worldToScreen(x,y,domain,range,w,h);

        ctx.beginPath();
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-green');
        ctx.lineWidth = 1;
        const L=1.5;
        const [sx1,sy1] = worldToScreen(x-L, y-m*L, domain, range, w, h);
        const [sx2,sy2] = worldToScreen(x+L, y+m*L, domain, range, w, h);
        ctx.moveTo(sx1,sy1); ctx.lineTo(sx2,sy2); ctx.stroke();
        
        ctx.beginPath(); ctx.fillStyle = '#c0392b';
        ctx.arc(px,py,4,0,Math.PI*2); ctx.fill();

        xDisp.textContent = x.toFixed(2);
        outX.textContent = x.toFixed(2);
        outY.textContent = y.toFixed(3);
        outYp.textContent = m.toFixed(3);
      }

      if (!isToolInitialized){
        slider.addEventListener('input', () => { updateState(); draw(); });
        radios.forEach(r => r.addEventListener('change', () => { setSliderConfig(); draw(); }));
        window.addEventListener('resize', draw);
        isToolInitialized = true;
      }
      setSliderConfig();
      draw();
    }

    // --- Deck Initialization and Event Binding ---
    
    deck.on('ready', () => {
      setupThemeToggle();
      updateHeaderTopic();
      // FIX: The function call to enable interactions was missing. It is now added.
      setupDeckInteractions(); 
      document.querySelectorAll('.poll').forEach(renderPollResults);
      if (document.getElementById('derivative-tool-slide')?.classList.contains('present')) {
        setupDerivativeTool();
      }
    });

    deck.on('slidechanged', e => {
      updateHeaderTopic();
      const poll = e.currentSlide.querySelector('.poll'); 
      if (poll) renderPollResults(poll);
      if (e.currentSlide.id === 'derivative-tool-slide') {
        setupDerivativeTool();
      }
    });
  </script>
</body>
</html>


