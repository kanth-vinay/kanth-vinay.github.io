<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chapter 8 — Confidence Intervals for One Population Mean — Prof. Kodipelly</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Reveal core -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/theme/white.min.css" id="theme-link">

  <!-- Menu plugin -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.css">

  <style>
    :root{
      --brand-primary:#00539C; --brand-secondary:#00325C; /* Statistics Blue */
      --accent-green:#2E7D32; --accent-orange:#EF6C00; --accent-red:#C62828;
      --text-primary:#111827; --text-secondary:#4B5563;
      --bg-primary:#FFFFFF; --bg-secondary:#F4F6F8; --border-color:#D1D5DB;
      --shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    [data-theme="dark"]{
      --brand-primary:#5D9CD4; --brand-secondary:#8BB8E8;
      --accent-green:#66BB6A; --accent-orange:#FFA726; --accent-red:#E57373;
      --text-primary:#F9FAFB; --text-secondary:#9CA3AF;
      --bg-primary:#111827; --bg-secondary:#1F2937; --border-color:#374151;
    }

    body{ font-family:'Inter',system-ui,sans-serif; color:var(--text-primary); background:var(--bg-primary); }

    #page-header,#page-footer{ position:fixed; left:0; right:0; z-index:1000; background:var(--brand-primary); color:#fff; display:flex; align-items:center; justify-content:space-between; padding:0 20px; box-shadow:var(--shadow-md); font-family:'Poppins', sans-serif; }
    #page-header{ top:0; height:64px; }
    #page-footer{ bottom:0; height:40px; font-size:.85em; }
    #page-header .author{ font-weight:700; font-size:1.1em; }
    #page-header .topic{ font-weight:500; opacity:.95; }
    #page-header .controls{ display:flex; gap:12px; align-items:center; }
    #page-footer .hints{ opacity:.85; }
    .theme-toggle{ background:none; border:1px solid #fff4; color:#fff; border-radius:999px; padding:6px 10px; cursor:pointer; font-weight:600; }
    
    .reveal{ margin-top:64px; margin-bottom:40px; font-size:28px; }
    .reveal .slides{ color:var(--text-primary); }
    .reveal .slides section{ display: flex; flex-direction: column; justify-content: center; height: 100%; padding: 1vh 0; }
    .reveal h2{ font-family:'Poppins', sans-serif; color:var(--brand-secondary); font-size:1.6em; margin-bottom:20px; }
    .reveal h3{ font-family:'Poppins', sans-serif; font-size:1.1em; font-weight:600; margin-bottom:15px; }
    .reveal p,.reveal li{ line-height:1.6; }
    .left-align{ text-align:left; max-width:950px; margin:0 auto; }
    
    .callout{ border-left:4px solid var(--accent-orange); background:var(--bg-secondary); padding:16px 20px; border-radius:8px; border:1px solid var(--border-color); margin:1em auto; max-width: 950px; }
    
    .card{ perspective:1200px; width:min(900px,90vw); margin:16px auto; cursor:pointer; }
    .card-inner{ position:relative; width:100%; min-height:180px; transition:transform .6s; transform-style:preserve-3d; }
    .card.flipped .card-inner{ transform:rotateY(180deg); }
    .card-face{ position:absolute; inset:0; display:flex; flex-direction: column; align-items:center; justify-content:center; backface-visibility:hidden; border-radius:10px; border:1px solid var(--border-color); padding:20px; background:var(--bg-primary); box-shadow:var(--shadow-md); text-align:center; }
    .card-face.front{ background:var(--bg-secondary); }
    .card-face.back{ transform:rotateY(180deg); text-align: left; font-size: 0.9em; justify-content: flex-start;}

    .icon-list li { list-style: none; padding-left: 2.5em; position: relative; margin-bottom: 0.75em; }
    .icon-list li::before { content: ''; position: absolute; left: 0; top: 5px; width: 1.2em; height: 1.2em; background-size: contain; background-repeat: no-repeat; }
    .icon-list .target::before { background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23EF6C00"%3E%3Cpath d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v4h-2zm0 6h2v2h-2z"/%3E%3C/svg%3E'); }
    .icon-list .net::before { background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2300539C"%3E%3Cpath d="M22 11h-2V9h-2v2h-2v2h2v2h2v-2h2v-2zm-10-1.64c.94.03 1.83.26 2.65.65A10.02 10.02 0 0 0 12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c1.35 0 2.64-.27 3.82-.75-.61-.38-1.17-.84-1.68-1.35C13.06 20.94 12.08 21 11 21c-4.97 0-9-4.03-9-9s4.03-9 9-9c.74 0 1.45.11 2.13.29-.02.3-.06.6-.06.91z"/%3E%3C/svg%3E'); }
    .icon-list .check::before { background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%232E7D32"%3E%3Cpath d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/%3E%3C/svg%3E'); }

    .interactive-tool { background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); max-width: 1000px; margin: 15px auto; font-size: 0.8em; }
    .tool-controls { display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }
    .tool-controls label { font-weight: 500; }
    #curve-canvas { width: 100%; height: 250px; display: block; }
    
    #ci-simulation { width: 100%; max-width: 600px; height: 300px; margin: 10px auto; position: relative; border: 1px solid var(--border-color); background: var(--bg-primary); border-radius: 8px; }
    #ci-simulation .mu-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background-color: var(--brand-primary); z-index: 1; }
    #ci-simulation .mu-label { position: absolute; left: 50%; top: -5px; transform: translateX(-50%); font-weight: bold; color: var(--brand-primary); }
    .ci-sample-line { position: absolute; height: 4px; border-radius: 2px; transition: background-color 0.5s; }
    .ci-sample-line .x-bar { position: absolute; top: 50%; width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; transform: translateY(-50%); }

    .two-col-layout { display: flex; gap: 20px; align-items: flex-start; max-width: 1100px; margin: 0 auto; }
    .col { flex: 1; padding: 15px; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-secondary); }
    .col h3 { margin-top: 0; }
    .z-table { width: 100%; text-align: center; border-collapse: collapse; margin-top: 15px; }
    .z-table th, .z-table td { border: 1px solid var(--border-color); padding: 8px; }
    .z-table thead { background-color: var(--brand-secondary); color: white; }
    .t-table-img { width: 100%; border: 1px solid var(--border-color); border-radius: 8px; margin-top: 15px; }
  </style>
</head>
<body>

  <header id="page-header"><div class="author">Prof. Vinay Kanth Rao Kodipelly</div><div class="topic" id="topic-slot">Statistics</div><div class="controls"><button class="theme-toggle" id="theme-toggle">Theme</button></div></header>
  <footer id="page-footer"><div class="brand">University of Missouri–St. Louis</div><div class="hints">←/→ • F • S</div></footer>

  <div class="reveal">
    <div class="slides">
      <section data-menu="title" data-topic="Confidence Intervals">
        <h2>Confidence Intervals for One Population Mean</h2>
        <h3 class="muted">Visualizing how samples estimate the true mean</h3>
        <div id="ci-simulation" class="fragment">
          <div class="mu-line"></div><div class="mu-label">μ</div>
        </div>
      </section>

      <section data-menu="objectives" data-topic="Objectives">
        <h2>Learning Objectives</h2>
        <ul class="left-align icon-list">
          <li class="target">Define point estimates and confidence intervals.</li>
          <li class="net">Understand the true meaning of a "confidence level".</li>
          <li class="check">Construct and interpret intervals when \(\sigma\) is known (z-interval) and unknown (t-interval).</li>
        </ul>
      </section>
      
      <section data-menu="point-estimate" data-topic="Point Estimates">
        <h2>What's a Point Estimate?</h2>
        <div class="left-align">
          <p>Imagine trying to find the average age of everyone in St. Louis.</p>
          <p class="fragment">It's impossible to ask everyone. So, you take a <strong>sample</strong> of 100 people and find their average age is <strong>41.2 years</strong>.</p>
          <p class="fragment">This single number, 41.2, is your <strong>point estimate</strong>. It's your single best guess for the true average age of the entire city (\(\mu\)).</p>
          <div class="callout fragment"><strong>Definition:</strong> A point estimate is a single value (a statistic) used to estimate a population parameter. The sample mean (\(\bar{x}\)) is the point estimate for the population mean (\(\mu\)).</div>
        </div>
      </section>

      <section data-menu="ci-intro" data-topic="Confidence Intervals">
        <h2>From a Point to a Range</h2>
        <div class="left-align">
            <p>A point estimate is almost certainly wrong. The true average age probably isn't <strong>exactly</strong> 41.2.</p>
            <p class="fragment">It's more useful to provide a <strong>range</strong>. For example: "I am 95% confident that the true average age is between <strong>38.7 and 43.7 years</strong>."</p>
            <p class="fragment">This range is a <strong>Confidence Interval (CI)</strong>. It gives us a plausible set of values for the true population mean, \(\mu\).</p>
        </div>
      </section>
      
      <section data-menu="confidence-level" data-topic="Confidence Level">
          <h2>The "Catcher's Mitt" Analogy</h2>
          <p>What does "95% confident" really mean?</p>
          <div class="left-align fragment">
              <ul class="icon-list">
                  <li class="target">The true population mean (\(\mu\)) is a fixed, unknown target. Think of a baseball thrown to the exact same spot every time.</li>
                  <li class="net">Each time you take a sample, you create a confidence interval (\(\bar{x} \pm \text{error}\)). This is your "catcher's mitt".</li>
                  <li class="check">A <strong>95% confidence level</strong> means that the <strong>method</strong> you're using will produce a mitt that successfully catches the true mean 95% of the time.</li>
              </ul>
          </div>
          <p class="fragment small" style="color:var(--accent-orange);">It's a confidence in the <strong>process</strong>, not in any single interval!</p>
      </section>

      <section data-menu="sigma-known" data-topic="σ Known: The z-Interval">
        <h2>Scenario 1: The z-Interval (When \(\sigma\) is Known)</h2>
        <div class="left-align">
          <p>This is the ideal scenario. We know the true standard deviation (\(\sigma\)) of the entire population.</p>
          <div class="callout">
              <strong>Assumptions:</strong> Simple random sample, population is normal OR sample size is large (\(n \ge 30\)), and \(\sigma\) is known.
          </div>
          <h3>Formula: \(\text{CI} = \bar{x} \pm z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}}\)</h3>
        </div>
      </section>

      <section data-menu="z-example" data-topic="z-Interval Example">
          <h2>Try It: Calculate a z-Interval</h2>
          <div class="left-align">
              <p>A sample of 50 UMSL students has a mean GPA of 3.2. Assume the population standard deviation (\(\sigma\)) of all student GPAs is 0.5. Calculate a 95% confidence interval for the true mean GPA.</p>
          </div>
          <div class="card">
              <div class="card-inner">
                  <div class="card-face front"><h3>Click to Reveal Solution</h3></div>
                  <div class="card-face back">
                      <ol>
                        <li><strong>Identify Values:</strong> \(\bar{x}=3.2\), \(\sigma=0.5\), \(n=50\). For 95% confidence, \(z_{\alpha/2} = 1.96\).</li>
                        <li><strong>Calculate Margin of Error (E):</strong> \[E = z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}} = 1.96 \cdot \frac{0.5}{\sqrt{50}} \approx 0.139\]</li>
                        <li><strong>Construct Interval:</strong> \(3.2 \pm 0.139 \Rightarrow (3.061, 3.339)\)</li>
                        <li><strong>Interpret:</strong> We are 95% confident that the true mean GPA of all UMSL students is between 3.061 and 3.339.</li>
                      </ol>
                  </div>
              </div>
          </div>
      </section>
      
      <section data-menu="sigma-unknown" data-topic="σ Unknown: The t-Interval">
        <h2>Scenario 2: The t-Interval (When \(\sigma\) is Unknown)</h2>
        <div class="left-align">
          <p>This is the real-world scenario. We don't know the population's true spread, so we estimate it with our sample's standard deviation (\(s\)).</p>
          <p class="fragment">This extra uncertainty requires a different distribution: the <strong>Student's t-distribution</strong>.</p>
          <div class="callout fragment">The t-distribution is like the normal distribution, but with "fatter tails" to account for the uncertainty of using \(s\) instead of \(\sigma\). Its shape depends on <strong>degrees of freedom (df = n - 1)</strong>.</div>
        </div>
      </section>

      <section data-menu="t-visualizer" data-topic="Visualizing z vs. t">
          <h2>Interactive: z vs. t Distribution</h2>
          <p class="small">See how the t-distribution (green) compares to the z-distribution (blue).</p>
          <div class="interactive-tool">
              <div class="tool-controls">
                  <label for="df-slider">Degrees of Freedom (n-1): <span id="df-val">5</span></label>
                  <input type="range" id="df-slider" min="1" max="50" value="5" step="1">
                  <label for="conf-slider">Confidence: <span id="conf-val">95</span>%</label>
                  <input type="range" id="conf-slider" min="80" max="99" value="95" step="1">
              </div>
              <canvas id="curve-canvas"></canvas>
              <div class="tool-output" id="curve-output">
                  <span style="color:var(--brand-primary);">\(z_{\alpha/2}\): 1.960</span> | <span style="color:var(--accent-green);">\(t_{\alpha/2}\): 2.571</span>
              </div>
          </div>
      </section>

      <!-- NEW SLIDE: Finding Critical Values -->
      <section data-menu="critical-values" data-topic="Finding Critical Values">
        <h2>Finding Critical Values: \(z_{\alpha/2}\) vs. \(t_{\alpha/2}\)</h2>
        <div class="two-col-layout">
          <div class="col">
            <h3>Common z-Scores for CIs</h3>
            <p class="small">Since the standard normal curve doesn't change, these z-scores are always the same for a given confidence level.</p>
            <table class="z-table">
              <thead><tr><th>Confidence</th><th>\(\alpha\)</th><th>\(\alpha/2\)</th><th>\(z_{\alpha/2}\)</th></tr></thead>
              <tbody>
                <tr><td>90%</td><td>0.10</td><td>0.05</td><td>1.645</td></tr>
                <tr><td>95%</td><td>0.05</td><td>0.025</td><td>1.960</td></tr>
                <tr><td>99%</td><td>0.01</td><td>0.005</td><td>2.576</td></tr>
              </tbody>
            </table>
            <p class="small fragment"><strong>Note:</strong> Confidence intervals are always two-tailed!</p>
          </div>
          <div class="col">
            <h3>Reading a t-Table for CIs</h3>
            <p class="small">The t-score depends on both confidence and degrees of freedom (df).</p>
            <p class="small"><strong>Example:</strong> Find \(t_{\alpha/2}\) for a 95% CI with \(n=25\).</p>
            <ol class="small" style="padding-left: 20px;">
              <li><strong>Confidence = 95%</strong> \(\Rightarrow\) \(\alpha = 0.05\)</li>
              <li><strong>Two-Tailed CI</strong> \(\Rightarrow\) area in each tail is \(\alpha/2 = 0.025\)</li>
              <li><strong>Degrees of Freedom</strong> = \(n-1 = 24\)</li>
            </ol>
            <p class="small">Look for the column for <strong>Area in Upper Tail = 0.025</strong> and the row for <strong>df = 24</strong>.</p>
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 150'%3E%3Crect width='400' height='150' fill='%23fff'/%3E%3Cstyle%3E.heavy{font-weight:bold;}.small{font-size:12px;}.faint{fill:%236c757d;}.highlight{fill:%23C62828; font-weight:bold;}%3C/style%3E%3Crect x='1' y='1' width='398' height='148' fill='none' stroke='%23D1D5DB'/%3E%3Crect x='1' y='1' width='398' height='30' fill='%2300325C'/%3E%3Ctext x='25' y='22' fill='white' class='small heavy'%3Edf%3C/text%3E%3Ctext x='80' y='22' fill='white' class='small heavy'%3E...%3C/text%3E%3Ctext x='150' y='22' fill='white' class='small heavy'%3Et_0.05%3C/text%3E%3Ctext x='225' y='22' fill='white' class='small heavy'%3Et_0.025%3C/text%3E%3Ctext x='300' y='22' fill='white' class='small heavy'%3Et_0.01%3C/text%3E%3Cpath d='M60 1 V149 M135 31 V149 M210 31 V149 M285 31 V149' stroke='%23D1D5DB' stroke-width='.5'/%3E%3Cpath d='M1 31 H399 M1 61 H399 M1 91 H399 M1 121 H399' stroke='%23D1D5DB' stroke-width='.5'/%3E%3C!-- df column --%3E%3Ctext x='25' y='52' class='faint small heavy'%3E22%3C/text%3E%3Ctext x='25' y='82' class='small heavy'%3E23%3C/text%3E%3Ctext x='25' y='112' class='small heavy'%3E24%3C/text%3E%3Ctext x='25' y='142' class='faint small heavy'%3E25%3C/text%3E%3C!-- t_0.025 column --%3E%3Ctext x='230' y='52' class='faint small'%3E2.074%3C/text%3E%3Ctext x='230' y='82' class='faint small'%3E2.069%3C/text%3E%3Ctext x='230' y='112' class='highlight small'%3E2.064%3C/text%3E%3Ctext x='230' y='142' class='faint small'%3E2.060%3C/text%3E%3Crect x='211' y='32' width='73' height='116' fill='none' stroke='%23EF6C00' stroke-width='2'/%3E%3Crect x='2' y='92' width='396' height='30' fill='none' stroke='%23EF6C00' stroke-width='2'/%3E%3C/svg%3E" alt="A sample t-table showing how to find the critical value at the intersection of the correct df row and alpha/2 column." class="t-table-img"/>
          </div>
        </div>
      </section>


      <section data-menu="t-formula" data-topic="The t-Interval">
        <h2>The t-Interval Formula</h2>
        <div class="left-align">
          <p>The formula is almost identical. We just swap \(\sigma\) for \(s\) and \(z_{\alpha/2}\) for \(t_{\alpha/2}\).</p>
          <h3>\(\text{CI} = \bar{x} \pm t_{\alpha/2, n-1} \cdot \frac{s}{\sqrt{n}}\)</h3>
          <p class="fragment">As our sample size (\(n\)) gets larger, the t-distribution becomes nearly identical to the z-distribution, and the critical values converge.</p>
        </div>
      </section>

      <section data-menu="t-example" data-topic="t-Interval Example">
          <h2>Try It: Calculate a t-Interval</h2>
          <div class="left-align">
              <p>A random sample of 25 pickpocket offenses had a mean loss of $513 with a sample standard deviation of $262. Calculate a 90% confidence interval for the true mean loss.</p>
          </div>
          <div class="card">
              <div class="card-inner">
                  <div class="card-face front"><h3>Click to Reveal Solution</h3></div>
                  <div class="card-face back">
                      <ol>
                          <li><strong>Identify:</strong> \(\bar{x}=513\), \(s=262\), \(n=25\). Degrees of freedom \(df = 25 - 1 = 24\).</li>
                          <li><strong>Find Critical Value:</strong> For 90% confidence & df=24, look up \(t_{0.05, 24}\) in a t-table. You'll find \(t_{\alpha/2} = 1.711\).</li>
                          <li><strong>Calculate Margin of Error (E):</strong> \[E = t_{\alpha/2} \cdot \frac{s}{\sqrt{n}} = 1.711 \cdot \frac{262}{\sqrt{25}} \approx \$89.65\]</li>
                          <li><strong>Construct Interval:</strong> \(513 \pm 89.65 \Rightarrow (\$423.35, \$602.65)\)</li>
                          <li><strong>Interpret:</strong> We are 90% confident the true mean loss from such offenses is between $423.35 and $602.65.</li>
                      </ol>
                  </div>
              </div>
          </div>
      </section>

      <section data-menu="summary" data-topic="Summary">
          <h2>Summary: Which Interval Do I Use?</h2>
          <div style="background:var(--bg-secondary); padding: 20px; border-radius: 12px; max-width: 800px; margin: auto; border: 1px solid var(--border-color);">
            <h3 style="text-align:center; margin-top:0;">Is the population standard deviation (\(\sigma\)) known?</h3>
            <div style="display: flex; justify-content: space-around; text-align: center;">
              <div style="width: 45%;">
                <h3 style="color:var(--accent-green);">YES</h3>
                <p>Use the</p>
                <h2 style="color:var(--brand-secondary); margin-top: 10px;">z-Interval</h2>
                <p>\(\bar{x} \pm z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}}\)</p>
              </div>
              <div style="border-left: 2px solid var(--border-color);"></div>
              <div style="width: 45%;">
                <h3 style="color:var(--accent-orange);">NO</h3>
                <p>Use the</p>
                <h2 style="color:var(--brand-secondary); margin-top: 10px;">t-Interval</h2>
                <p>\(\bar{x} \pm t_{\alpha/2} \cdot \frac{s}{\sqrt{n}}\)</p>
              </div>
            </div>
          </div>
          <p class="small" style="text-align:center; margin-top: 20px;">Always check assumptions first: Random Sample & Normality/Large n!</p>
      </section>
    </div>
  </div>

  <!-- MathJax for LaTeX Rendering -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)']], displayMath: [['\\[', '\\]']] }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  
  <!-- JStat for statistical calculations -->
  <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>

  <!-- Reveal & plugins -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.js"></script>

  <script>
    const deck = new Reveal({ hash:true, slideNumber:'c/t', navigationMode:'default', transition:'fade', width:1280, height:720, margin:0.04, plugins:[RevealMenu] });
    deck.initialize();

    function setupThemeToggle(){
      const btn = document.getElementById('theme-toggle');
      if (!btn) return;
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
      let theme = localStorage.getItem('slides-theme') || (prefersDark.matches ? 'dark' : 'light');
      document.body.setAttribute('data-theme', theme);
      btn.addEventListener('click', () => {
        theme = (document.body.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
        document.body.setAttribute('data-theme', theme);
        localStorage.setItem('slides-theme', theme);
      });
    }
    function updateHeaderTopic(){
      const el = document.getElementById('topic-slot');
      if (el) el.textContent = deck.getCurrentSlide()?.dataset?.topic || 'Statistics';
    }

    function setupInteractions(){
      document.body.addEventListener('click', e => {
        const card = e.target.closest('.card');
        if(card) card.classList.toggle('flipped');
      });
    }

    function runCISimulation() {
        const container = document.getElementById('ci-simulation');
        if (!container || container.dataset.running) return;
        container.dataset.running = "true";
        container.innerHTML = '<div class="mu-line"></div><div class="mu-label">μ</div>'; // Clear previous lines

        const hitColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-green');
        const missColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-red');

        for (let i = 0; i < 20; i++) {
            setTimeout(() => {
                const line = document.createElement('div');
                line.className = 'ci-sample-line';
                
                const xBarEl = document.createElement('div');
                xBarEl.className = 'x-bar';

                const intervalWidth = 25 + Math.random() * 10; // %
                const xBarPos = 30 + Math.random() * 40; // %
                
                line.style.width = `${intervalWidth}%`;
                line.style.left = `${xBarPos - intervalWidth / 2}%`;
                line.style.top = `${5 + i * 4.5}%`;
                xBarEl.style.left = `${intervalWidth / 2}%`;
                
                const capturesMu = (xBarPos - intervalWidth/2 < 50) && (xBarPos + intervalWidth/2 > 50);
                
                line.style.backgroundColor = capturesMu ? hitColor : missColor;
                
                line.appendChild(xBarEl);
                container.appendChild(line);
            }, i * 100);
        }
    }


    let isCurveToolInitialized = false;
    function setupCurveTool() {
      const canvas = document.getElementById('curve-canvas');
      if (!canvas) return;
      const dfSlider = document.getElementById('df-slider');
      const confSlider = document.getElementById('conf-slider');
      const dfVal = document.getElementById('df-val');
      const confVal = document.getElementById('conf-val');
      const output = document.getElementById('curve-output');

      function draw() {
        const df = parseInt(dfSlider.value);
        const confidence = parseInt(confSlider.value) / 100;
        const alpha = 1 - confidence;

        dfVal.textContent = df;
        confVal.textContent = confSlider.value;
        
        const z_crit = jStat.normal.inv(1 - alpha / 2, 0, 1);
        const t_crit = (df > 0) ? jStat.studentt.inv(1 - alpha / 2, df) : Infinity;

        output.innerHTML = `<span style="color:var(--brand-primary);">\\(z_{\\alpha/2}\\): ${z_crit.toFixed(3)}</span> | <span style="color:var(--accent-green);">\\(t_{\\alpha/2}\\): ${t_crit.toFixed(3)}</span>`;
        if (window.MathJax) {
            MathJax.typesetPromise([output]);
        }

        const w = canvas.clientWidth, h = canvas.clientHeight;
        const ratio = window.devicePixelRatio || 1;
        canvas.width = w * ratio; canvas.height = h * ratio;
        const ctx = canvas.getContext('2d');
        ctx.scale(ratio, ratio);

        const xMin = -4, xMax = 4;
        const yMax = 0.45;

        const toScreenX = (x) => (x - xMin) / (xMax - xMin) * w;
        const toScreenY = (y) => h - (y / yMax) * h;

        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border-color');
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, toScreenY(0)); ctx.lineTo(w, toScreenY(0));
        ctx.stroke();

        function drawDist(pdf, color, crit_val, lineWidth = 2) {
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.beginPath();
            for (let i = 0; i <= w; i++) {
                const x = xMin + (i/w) * (xMax - xMin);
                const y = pdf(x);
                if (i === 0) ctx.moveTo(i, toScreenY(y));
                else ctx.lineTo(i, toScreenY(y));
            }
            ctx.stroke();
            
            ctx.fillStyle = color;
            ctx.globalAlpha = 0.2;
            const crit_sx = toScreenX(crit_val);
            const neg_crit_sx = toScreenX(-crit_val);

            ctx.beginPath();
            ctx.moveTo(crit_sx, toScreenY(0));
            for (let i = Math.floor(crit_sx); i <= w; i++) {
                const x = xMin + (i/w) * (xMax - xMin);
                ctx.lineTo(i, toScreenY(pdf(x)));
            }
            ctx.lineTo(w, toScreenY(0));
            ctx.closePath();
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(neg_crit_sx, toScreenY(0));
            for (let i = Math.floor(neg_crit_sx); i >= 0; i--) {
                 const x = xMin + (i/w) * (xMax - xMin);
                 ctx.lineTo(i, toScreenY(pdf(x)));
            }
            ctx.lineTo(0, toScreenY(0));
            ctx.closePath();
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }

        const t_color = getComputedStyle(document.documentElement).getPropertyValue('--accent-green');
        drawDist(x => jStat.studentt.pdf(x, df), t_color, t_crit, 3);
        
        const z_color = getComputedStyle(document.documentElement).getPropertyValue('--brand-primary');
        drawDist(x => jStat.normal.pdf(x, 0, 1), z_color, z_crit, 2);
      }

      if (!isCurveToolInitialized) {
        dfSlider.addEventListener('input', draw);
        confSlider.addEventListener('input', draw);
        window.addEventListener('resize', draw);
        new MutationObserver(draw).observe(document.body, { attributes: true, attributeFilter: ['data-theme'] });
        isCurveToolInitialized = true;
      }
      draw();
    }

    deck.on('ready', () => {
        setupThemeToggle();
        updateHeaderTopic();
        setupInteractions();
        if (deck.getCurrentSlide().contains(document.getElementById('ci-simulation'))) {
          runCISimulation();
        }
        if (document.getElementById('curve-canvas')) {
          setupCurveTool();
        }
    });

    deck.on('slidechanged', (event) => {
        updateHeaderTopic();
        if (event.currentSlide.contains(document.getElementById('ci-simulation'))) {
            runCISimulation();
        }
        if (event.currentSlide.contains(document.getElementById('curve-canvas'))) {
            setupCurveTool();
        }
    });
  </script>
</body>
</html>


