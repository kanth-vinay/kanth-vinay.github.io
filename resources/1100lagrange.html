<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Calculus — Optimization & Lagrange Multipliers</title>

  <!-- Reveal.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reset.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/serif.min.css" id="theme">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- Three.js for 3D Visualizations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>
    :root {
      --r-main-font-size: 28px;
      --header-h: 72px;
      --footer-h: 44px;
      --frame-pad: 18px;
    }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, Roboto, Arial, sans-serif;
    }
    .reveal h1, .reveal h2, .reveal h3 {
      text-transform: none;
    }
    .reveal h1 {
      font-size: 1.6em;
    }
    .reveal h2 {
      font-size: 1.4em;
    }
    .reveal h3 {
      font-size: 1.2em;
    }

    /* Fixed header + footer frame */
    #page-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-h);
      background-color: #1A237E;
      color: #fff;
      padding: 0 var(--frame-pad);
      font-size: 0.9em;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 60;
      box-sizing: border-box;
    }
    #page-footer {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: var(--footer-h);
      background-color: #1A237E;
      color: #fff;
      padding: 0 var(--frame-pad);
      font-size: 0.75em;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 60;
      box-sizing: border-box;
    }
    .reveal {
      height: calc(100vh - var(--header-h) - var(--footer-h));
      margin-top: var(--header-h);
    }
    .reveal section {
      max-height: 100%;
      overflow-y: auto;
    }

    /* Reusable blocks */
    .callout {
      border-left: 6px solid #4CAF50;
      background: #F5F7FF;
      padding: 12px 16px;
      border-radius: 8px;
      text-align: left;
      margin: 10px auto;
      max-width: 900px;
    }
    .key-concept {
      background: #FFF3E0;
      border: 2px solid #FF9800;
      border-radius: 10px;
      padding: 12px 16px;
      margin: 15px auto;
      max-width: 850px;
    }
    .formula-box {
      background: #E3F2FD;
      border: 2px solid #2196F3;
      border-radius: 10px;
      padding: 15px;
      margin: 15px auto;
      font-size: 1.0em;
      text-align: center;
      max-width: 700px;
    }
    .small-text {
      font-size: 0.75em;
    }
    .viz-container {
      margin: 20px auto;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 900px;
    }
    .interactive-demo {
      display: grid;
      gap: 14px;
      align-items: start;
    }
    .slider-control {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      margin: 6px 0;
    }
    .slider-control label {
      font-size: 0.85em;
      font-weight: 600;
    }
    .slider-control output {
      font-size: 0.85em;
      font-weight: 700;
      color: #1A237E;
    }
    .slider-control input[type="range"] {
      width: 100%;
    }
    canvas.regression-canvas {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #ffffff;
    }
    .step-list {
      text-align: left;
      max-width: 880px;
      margin: 0 auto;
      list-style: none;
      padding: 0;
      counter-reset: step-counter;
    }
    .step-list li {
      counter-increment: step-counter;
      margin: 12px 0;
      padding-left: 40px;
      position: relative;
    }
    .step-list li::before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #4CAF50;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9em;
    }
    .example-card {
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      padding: 14px 16px;
      background: #ffffff;
      max-width: 900px;
      margin: 10px auto;
      text-align: left;
    }
    .callout,
    .key-concept,
    .example-card {
      font-size: 0.95em;
    }
    .example-card h3 {
      margin-top: 0;
      font-size: 1.1em;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
      margin-top: 8px;
    }
    .chip {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.7em;
      background: #E3F2FD;
      border: 1px solid #90CAF9;
    }
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      align-items: start;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      font-size: 0.6em;
      border-radius: 999px;
      background: #E8F5E9;
      border: 1px solid #A5D6A7;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .highlight {
      background: #FFFDE7;
    }
    
    /* 3D Canvas container */
    #three-container {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
      background: #fafafa;
      position: relative;
    }
    #three-overlay {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px;
      border-radius: 8px;
      font-size: 0.7em;
      pointer-events: none;
      color: #333;
    }

    @media print {
      #page-header, #page-footer {
        display: none !important;
      }
      .reveal {
        margin-top: 0;
        height: 100vh;
      }
    }
  </style>
</head>
<body>
  <header id="page-header">
    <span>MATH 1100 — Basic Calculus</span>
    <span id="header-topic">Overview</span>
  </header>

  <footer id="page-footer">
    <span>Active Learning Institute / UMSL</span>
    <span>←/→ navigate • F fullscreen • S speaker notes</span>
  </footer>

  <div class="reveal">
    <div class="slides">

      <!-- Title -->
      <section data-topic="Overview">
        <h2>Optimization in Several Variables</h2>
        <h3>Unconstrained Extrema &amp; Lagrange Multipliers</h3>
        <div class="callout">
          <p style="margin:0">
            <strong>Today:</strong> We extend single-variable optimization to surfaces in 3D. We will learn to find peaks and valleys (relative extrema) and how to optimize functions subject to strict constraints.
          </p>
        </div>
        <aside class="notes">
          Start with the analogy of hiking. Finding the highest point on a hill (unconstrained) vs finding the highest point on a specific trail (constrained).
        </aside>
      </section>

      <!-- Context -->
      <section data-topic="Context">
        <h2>Where We Are</h2>
        <div class="callout" style="max-width:900px;">
          <p style="margin:0;">
            This chapter focuses on <strong>Functions of Several Variables</strong>.
          </p>
        </div>
        <div class="chip-row" style="margin-top:10px;">
          <span class="chip">Partial Derivatives</span>
          <span class="chip">Gradient Vectors</span>
          <span class="chip">Tangent Planes</span>
          <span class="chip highlight">Relative Extrema</span>
          <span class="chip highlight">Lagrange Multipliers</span>
        </div>
      </section>

      <!-- Learning goals -->
      <section data-topic="Goals">
        <h2>Learning Goals</h2>
        <ul style="text-align:left; max-width:880px; margin:0 auto;">
          <li>Define relative maximum and minimum for functions of two variables.</li>
          <li>Apply the <strong>D-Test</strong> (Second Partials Test) to classify critical points.</li>
          <li>Solve applied optimization problems (e.g., maximizing profit).</li>
          <li>Use the method of <strong>Lagrange Multipliers</strong> for constrained optimization.</li>
          <li>Understand the Extreme Value Theorem for closed and bounded regions.</li>
        </ul>
      </section>

      <!-- Definitions -->
      <section data-topic="Relative Extrema">
        <h2>Relative Extrema</h2>
        <div class="key-concept">
          <p style="margin:0">
            A function \(f(x,y)\) has a:
          </p>
          <ul style="margin:8px 0; padding-left:20px;">
            <li><strong>Relative Maximum</strong> at \((a,b)\) if \(f(x,y) \le f(a,b)\) for all points near \((a,b)\).</li>
            <li><strong>Relative Minimum</strong> at \((a,b)\) if \(f(x,y) \ge f(a,b)\) for all points near \((a,b)\).</li>
          </ul>
        </div>
        <p class="small-text" style="max-width:880px; margin:10px auto 0; text-align:left;">
          Just like in Calc I, these occur at <strong>critical points</strong> where the partial derivatives are zero:
          $$ f_x(a,b) = 0 \quad \text{and} \quad f_y(a,b) = 0 $$
        </p>
      </section>
      
      <!-- 3D Visualization Slide -->
      <section data-topic="3D Visualization">
        <h2>Visualizing Critical Points & Constraints</h2>
        <div class="two-col" style="max-width:950px; margin:0 auto; gap:20px;">
          <div>
             <div id="three-container">
               <div id="three-overlay">Click & Drag to Rotate</div>
             </div>
             <p class="small-text" style="text-align:center; margin-top:5px; color:#666;">
               <i>Rendered using Three.js</i>
             </p>
          </div>
          <div>
            <div class="example-card">
               <h3 style="margin:0 0 10px;">Select Surface Type:</h3>
               <div style="display:flex; flex-direction:column; gap:8px;">
                 <button class="chip" style="cursor:pointer; font-weight:bold;" onclick="update3DShape('min')">
                   Relative Minimum (Bowl)
                 </button>
                 <button class="chip" style="cursor:pointer; font-weight:bold;" onclick="update3DShape('max')">
                   Relative Maximum (Hill)
                 </button>
                 <button class="chip" style="cursor:pointer; font-weight:bold;" onclick="update3DShape('saddle')">
                   Saddle Point (Pass)
                 </button>
               </div>
               <div style="margin-top:12px; padding-top:10px; border-top:1px solid #eee;">
                   <label style="font-size:0.8em; font-weight:bold; cursor:pointer;">
                     <input type="checkbox" id="constraint-toggle" onchange="toggleConstraint()"> 
                     Show Constraint Cylinder ($x^2+y^2=k$)
                   </label>
               </div>
               <hr style="margin:15px 0;">
               <p class="small-text" id="shape-desc">
                 <strong>Currently Viewing:</strong> Saddle Point.<br>
                 Notice how the surface curves UP in one direction and DOWN in the other.
               </p>
            </div>
          </div>
        </div>
      </section>

      <!-- The D-Test -->
      <section data-topic="The D-Test">
        <h2>The D-Test (Second Partials Test)</h2>
        <div class="formula-box" style="max-width:800px;">
          $$ D = f_{xx}(a,b) \cdot f_{yy}(a,b) - [f_{xy}(a,b)]^2 $$
        </div>
        <div class="two-col" style="max-width:950px; margin:20px auto;">
          <div style="font-size: 0.85em;">
            <strong>Step 1:</strong> Find all second partials: \(f_{xx}, f_{yy}, f_{xy}\).<br>
            <strong>Step 2:</strong> Evaluate \(D\) at critical point \((a,b)\).
          </div>
          <div class="example-card" style="margin:0;">
            <h3 style="margin:0 0 6px;">Classification</h3>
            <ul style="font-size:0.8em; margin:0; padding-left:18px;">
              <li>If \(D > 0\) and \(f_{xx} < 0\) \(\to\) <strong>Relative Max</strong></li>
              <li>If \(D > 0\) and \(f_{xx} > 0\) \(\to\) <strong>Relative Min</strong></li>
              <li>If \(D < 0\) \(\to\) <strong>Saddle Point</strong></li>
              <li>If \(D = 0\) \(\to\) <strong>Inconclusive</strong></li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Interactive D-Test Visualizer -->
      <section data-topic="Visualizing D-Test">
        <h2>Visualizing the D-Test Logic</h2>
        <div class="key-concept">
          <p style="margin:0;">
            The sign of \(D\) tells us if the curvature is the "same" in all directions (Extrema) or "opposite" (Saddle).
          </p>
        </div>
        <div class="two-col" style="max-width:900px; margin:0 auto;">
          <div class="viz-container" style="padding:12px;">
            <canvas id="dTestCanvas" class="regression-canvas" width="360" height="260" aria-label="Visual representation of D-Test classification"></canvas>
            <div class="interactive-demo" style="margin-top:8px;">
              <div class="slider-control">
                <label> \(f_{xx}\) (Concavity X)</label>
                <input id="fxxSlider" type="range" min="-5" max="5" step="1" value="2">
                <output id="fxxVal">2</output>
              </div>
              <div class="slider-control">
                <label> \(f_{yy}\) (Concavity Y)</label>
                <input id="fyySlider" type="range" min="-5" max="5" step="1" value="2">
                <output id="fyyVal">2</output>
              </div>
              <div class="slider-control">
                <label> \(f_{xy}\) (Twist)</label>
                <input id="fxySlider" type="range" min="0" max="5" step="1" value="1">
                <output id="fxyVal">1</output>
              </div>
            </div>
          </div>
          <div class="example-card">
            <h3>Result:</h3>
            <div id="dTestResult" style="font-size: 1.2em; font-weight: bold; color: #1A237E; margin: 10px 0;">
              Calculating...
            </div>
            <p class="small-text">
              <strong>Scenario:</strong> <span id="dTestExplanation"></span>
            </p>
            <hr style="border: 0; border-top: 1px solid #ccc;">
            <p class="small-text">
              Note: A Saddle Point occurs when concavities oppose each other (one positive, one negative) OR when the "twist" (\(f_{xy}\)) dominates the product of concavities.
            </p>
          </div>
        </div>
      </section>

      <!-- Example 1 -->
      <section data-topic="Example 1">
        <h2>Example 1: Unconstrained Optimization</h2>
        <div class="example-card">
          <h3 style="margin:0 0 6px;">Find relative extrema of \(f(x,y) = x^2 + xy + y^2 - 3x\)</h3>
          
          <div class="two-col" style="grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
              <p class="small-text"><strong>Step 1: Find the partial derivatives.</strong></p>
              <p class="small-text">
                Differentiate with respect to \(x\) (treat \(y\) as a constant):
              </p>
              <ul style="font-size:0.75em; margin:0 0 10px 15px;">
                <li>\(\dfrac{\partial}{\partial x}(x^2) = 2x\)</li>
                <li>\(\dfrac{\partial}{\partial x}(xy) = y\)</li>
                <li>\(\dfrac{\partial}{\partial x}(y^2) = 0\)</li>
                <li>\(\dfrac{\partial}{\partial x}(-3x) = -3\)</li>
              </ul>
              <p class="small-text" style="margin-top:-6px;">
                So
                \[
                  f_x = 2x + y - 3.
                \]
              </p>
              <p class="small-text">
                Differentiate with respect to \(y\) (treat \(x\) as a constant):
              </p>
              <ul style="font-size:0.75em; margin:0 0 10px 15px;">
                <li>\(\dfrac{\partial}{\partial y}(x^2) = 0\)</li>
                <li>\(\dfrac{\partial}{\partial y}(xy) = x\)</li>
                <li>\(\dfrac{\partial}{\partial y}(y^2) = 2y\)</li>
                <li>\(\dfrac{\partial}{\partial y}(-3x) = 0\)</li>
              </ul>
              <p class="small-text" style="margin-top:-6px;">
                So
                \[
                  f_y = x + 2y.
                \]
              </p>

              <p class="small-text"><strong>Step 2: Find critical points by solving \(f_x = 0\) and \(f_y = 0\).</strong></p>
              <p class="small-text">
                We solve the system
                \[
                  \begin{cases}
                    2x + y - 3 = 0 \\
                    x + 2y = 0
                  \end{cases}
                \]
                From the second equation, \(x = -2y\). Substitute into the first:
                \[
                  2(-2y) + y - 3 = 0 \Rightarrow -4y + y - 3 = 0 \Rightarrow -3y = 3 \Rightarrow y = -1.
                \]
                Then \(x = -2(-1) = 2\). So our only critical point is \((2,-1)\).
              </p>
            </div>
            <div>
              <p class="small-text"><strong>Step 3: Use the D-Test to classify the critical point.</strong></p>
              <p class="small-text">
                Now compute the second partial derivatives:
              </p>
              <ul style="font-size:0.75em; margin:0 0 10px 15px;">
                <li>\(f_{xx} = \dfrac{\partial}{\partial x}(2x + y - 3) = 2\)</li>
                <li>\(f_{yy} = \dfrac{\partial}{\partial y}(x + 2y) = 2\)</li>
                <li>\(f_{xy} = \dfrac{\partial}{\partial y}(2x + y - 3) = 1\)</li>
              </ul>
              <p class="small-text">
                The D-test number is
                \[
                  D = f_{xx} f_{yy} - (f_{xy})^2 = (2)(2) - (1)^2 = 4 - 1 = 3.
                \]
                Since \(D &gt; 0\) and \(f_{xx} = 2 &gt; 0\), the surface curves up in all directions at \((2,-1)\), like the bottom of a bowl.
              </p>
              <p class="small-text" style="color:#1A237E;">
                \(\Rightarrow\) \((2,-1)\) is a <strong>relative minimum</strong>.
              </p>
              <p class="small-text">
                For completeness, the minimum value is
                \[
                  f(2,-1) = (2)^2 + (2)(-1) + (-1)^2 - 3(2)
                           = 4 - 2 + 1 - 6 = -3.
                \]
                So the function has a relative minimum value of \(-3\) at the point \((2,-1)\).
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Constrained Optimization Intro -->
      <section data-topic="Constrained Optimization">
        <h2>Constrained Optimization</h2>
        <div class="key-concept">
          <p style="margin:0;">
            Sometimes we want to maximize a function \(f(x,y)\) (Objective) but we are restricted to a specific path \(g(x,y)=k\) (Constraint).
          </p>
        </div>
        <div class="two-col" style="max-width:900px; margin:20px auto;">
          <div>
            <h4 style="font-size: 0.9em;">Common Examples</h4>
            <ul style="font-size: 0.8em;">
              <li><strong>Business:</strong> Maximize Profit subject to a budget constraint.</li>
              <li><strong>Geometry:</strong> Maximize Volume subject to fixed Surface Area.</li>
              <li><strong>Physics:</strong> Minimize Energy subject to a specific path.</li>
            </ul>
          </div>
          <div>
            <div class="formula-box" style="margin: 0;">
              $$ F(x,y,\lambda) = f(x,y) - \lambda \cdot g(x,y) $$
            </div>
            <p class="small-text" style="text-align: center; margin-top: 5px;">The Lagrange Function</p>
          </div>
        </div>
      </section>

      <!-- Lagrange Method -->
      <section data-topic="Method of Lagrange Multipliers">
        <h2>The Method of Lagrange Multipliers</h2>
        <ol class="step-list">
          <li><strong>Identify:</strong> The objective \(f(x,y)\) and the constraint \(g(x,y)=0\).</li>
          <li><strong>Formulate:</strong> Create the Lagrange function:
             $$ F(x,y,\lambda) = f(x,y) - \lambda g(x,y) $$
          </li>
          <li><strong>Differentiate:</strong> Find partials \(F_x, F_y, F_{\lambda}\).</li>
          <li><strong>Solve:</strong> Set all partials to zero and solve the system:
             $$ F_x=0, \quad F_y=0, \quad F_{\lambda}=0 $$
          </li>
          <li><strong>Evaluate:</strong> Test the solutions in \(f(x,y)\) to find max/min.</li>
        </ol>
      </section>

      <!-- Interactive Lagrange Visual -->
      <section data-topic="Lagrange Visualization">
        <h2>Visualizing Lagrange Multipliers</h2>
        <div class="key-concept">
          <p style="margin:0;">
            The maximum occurs where the <strong>constraint curve</strong> is tangent to the <strong>level curves</strong> of the objective function.
          </p>
        </div>
        <div class="two-col" style="max-width:900px; margin:0 auto;">
          <div class="viz-container" style="padding:12px;">
            <canvas id="lagrangeCanvas" class="regression-canvas" width="360" height="260" aria-label="Interactive canvas showing constraint line and objective function contours"></canvas>
            <div class="interactive-demo" style="margin-top:8px;">
              <div class="slider-control">
                <label>Contour Value \(k\) ($xy=k$)</label>
                <input id="contourSlider" type="range" min="10" max="150" step="5" value="50">
                <output id="contourVal">50</output>
              </div>
            </div>
            <p class="small-text" style="text-align:center; margin-top:4px;">
              Adjust \(k\) to find the highest contour that still touches the blue line ($x+y=20$).
            </p>
          </div>
          <div class="example-card">
            <h3 style="margin:0 0 6px;">Example 1 Setup</h3>
            <p class="small-text">
              <strong>Objective:</strong> Maximize Area \(A(x,y) = xy\) <br>
              <strong>Constraint:</strong> Perimeter fixed \(x + y = 20\)
            </p>
            <hr>
            <p class="small-text">
              Geometric Interpretation:
              <br><br>
              The blue line is our budget ($x+y=20$).
              The orange curves are different "profit levels" ($xy=k$).
              <br><br>
              We want the highest orange curve that intersects the blue line.
              This happens at the <strong>tangent point</strong>.
            </p>
          </div>
        </div>
      </section>

      <!-- Example 4: Feasible Regions -->
      <section data-topic="Inequality Constraints">
        <h2>Optimization with Inequality Constraints</h2>
        <div class="callout">
          <p style="margin:0;">
            If the constraint is an inequality (e.g., \(2x + 4y \le 40\)), we have a <strong>Region of Feasibility</strong>.
          </p>
        </div>
        <div class="two-col" style="max-width:900px; margin:20px auto;">
          <div>
            <div class="example-card">
              <h3 style="margin:0 0 6px;">Strategy</h3>
              <ul style="font-size:0.8em; margin:0; padding-left:18px;">
                <li><strong>Interior:</strong> Check for critical points inside the region (\(f_x=0, f_y=0\)).</li>
                <li><strong>Boundaries:</strong> Check the edges (lines/axes). This often becomes a Lagrange problem or 1-variable calc problem.</li>
                <li><strong>Corners:</strong> Check vertices (e.g., \((0,0), (20,0)\)).</li>
              </ul>
            </div>
          </div>
          <div>
            <div class="viz-container" style="padding:12px; margin:0;">
               <canvas id="feasibleCanvas" class="regression-canvas" width="360" height="200" aria-label="Feasible Region Triangle"></canvas>
               <p class="small-text" style="text-align:center;">Region: \(2x+4y \le 40, x\ge0, y\ge0\)</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Common Mistakes -->
      <section data-topic="Summary">
        <h2>Common Mistakes &amp; Tips</h2>
        <div class="example-card">
          <h3>Watch Out For:</h3>
          <ul style="font-size:0.85em; margin:0; padding-left:18px;">
            <li><strong>The D-Test:</strong> Remember \(D\) is not enough. You must check \(f_{xx}\) to distinguish Max vs Min.</li>
            <li><strong>Lagrange Algebra:</strong> Don't divide by zero when solving the system. Consider cases where \(x=0\) or \(\lambda=0\) separately.</li>
            <li><strong>Boundaries:</strong> In applied problems (like the box volume), don't forget the domain implies \(x,y,z > 0\).</li>
            <li><strong>Saddle Points:</strong> A saddle point is like a mountain pass; up in one direction, down in another.</li>
          </ul>
        </div>
      </section>

      <!-- ================= WORKSHOP SECTION ================= -->
      
      <!-- Workshop Title -->
      <section data-topic="Workshop Intro">
        <h2>Workshop Session</h2>
        <h3>Guided Practice with Homework Problems</h3>
        <div class="callout">
          <p style="margin:0">
            Let's apply what we learned to solve 4 selected problems from the homework set.
          </p>
        </div>
        <div class="chip-row" style="margin-top:15px;">
          <span class="chip">Prob 2: Unconstrained</span>
          <span class="chip">Prob 8: Business Profit</span>
          <span class="chip">Prob 15: Lagrange</span>
          <span class="chip">Prob 23: Geometric</span>
        </div>
      </section>

      <!-- Problem 2 -->
      <section data-topic="Problem 2">
        <h2>Problem 2: Unconstrained Optimization</h2>
        <div class="example-card">
          <h3 style="margin:0 0 6px;">Find relative maxima and minima</h3>
          <p style="font-size: 1.2em; text-align: center; margin: 20px 0;">
            $$ f(x,y) = 4xy - x^3 - 2y^2 $$
          </p>
        </div>
        <div class="callout">
          <p style="margin:0">
            <strong>Strategy:</strong> 
            1. Find Partial Derivatives (\(f_x, f_y\)). <br>
            2. Solve the system \(f_x=0, f_y=0\) for Critical Points. <br>
            3. Apply the D-Test.
          </p>
        </div>
      </section>

      <!-- Problem 2 Solution -->
      <section data-topic="Problem 2 Solution">
        <h3>Solution: Problem 2</h3>
        <div class="two-col" style="max-width:950px; margin:0 auto; gap:20px;">
          <div class="example-card">
            <h4 style="margin:0;">Step 1: Find Critical Points</h4>
            <div class="small-text">
              <p>
                We first find the partial derivatives. Think of this as doing Calc I in each direction separately:
              </p>
              <p>
                Differentiate with respect to \(x\):
                \[
                  f_x = 4y - 3x^2.
                \]
                Set \(f_x = 0\):
                \[
                  4y - 3x^2 = 0 \Rightarrow y = \frac{3}{4}x^2.
                \]
              </p>
              <p>
                Differentiate with respect to \(y\):
                \[
                  f_y = 4x - 4y.
                \]
                Set \(f_y = 0\):
                \[
                  4x - 4y = 0 \Rightarrow y = x.
                \]
              </p>
              <p>
                Now both must be true at a critical point, so we set the two expressions for \(y\) equal:
                \[
                  x = \frac{3}{4}x^2.
                \]
                Rearranging:
                \[
                  3x^2 - 4x = 0 \Rightarrow x(3x - 4) = 0.
                \]
                So either \(x = 0\) or \(x = \dfrac{4}{3}\).
              </p>
              <p>
                Using \(y = x\), the corresponding points are:
                \[
                  (0,0) \quad \text{and} \quad \left(\frac{4}{3}, \frac{4}{3}\right).
                \]
              </p>
            </div>
          </div>
          <div class="example-card">
            <h4 style="margin:0;">Step 2: Use the D-Test to Classify Each Point</h4>
            <div class="small-text">
              <p>
                Compute the second partial derivatives once (they do not depend on the point):
                \[
                  f_{xx} = -6x,\quad f_{yy} = -4,\quad f_{xy} = 4.
                \]
              </p>
              <p>
                The D-test value is
                \[
                  D = f_{xx} f_{yy} - (f_{xy})^2 = (-6x)(-4) - 4^2 = 24x - 16.
                \]
              </p>
              <hr>
              <p>
                <strong>At \((0,0)\):</strong><br>
                \[
                  D = 24(0) - 16 = -16 &lt; 0.
                \]
                When \(D &lt; 0\), the point is a <strong>saddle point</strong> (up in one direction, down in another).
              </p>
              <hr>
              <p>
                <strong>At \(\left(\frac{4}{3},\frac{4}{3}\right)\):</strong><br>
                \[
                  D = 24\left(\frac{4}{3}\right) - 16 = 32 - 16 = 16 &gt; 0,
                \]
                and
                \[
                  f_{xx} = -6\left(\frac{4}{3}\right) = -8 &lt; 0.
                \]
                When \(D &gt; 0\) and \(f_{xx} &lt; 0\), the surface curves down in all directions, so we have a <strong>relative maximum</strong>.
              </p>
              <p>
                The maximum value is
                \[
                  f\left(\frac{4}{3},\frac{4}{3}\right)
                  = 4\left(\frac{4}{3}\right)\left(\frac{4}{3}\right)
                    - \left(\frac{4}{3}\right)^3
                    - 2\left(\frac{4}{3}\right)^2
                  = \frac{32}{27}.
                \]
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Problem 8 -->
      <section data-topic="Problem 8">
        <h2>Problem 8: Business Application</h2>
        <div class="example-card">
          <h3 style="margin:0 0 6px;">Maximize Profit</h3>
          <p class="small-text">
            <strong>Revenue:</strong> \( R(x,y) = 4x + 5y \) <br>
            <strong>Cost:</strong> \( C(x,y) = x^2 - 3xy + 9y^2 + 3x - 34y - 2 \) <br>
            (x, y in thousands; $ in millions)
          </p>
        </div>
        <div class="callout">
          <p style="margin:0">
            <strong>Strategy:</strong> 
            Recall that \( \text{Profit} = \text{Revenue} - \text{Cost} \). <br>
            Construct \( P(x,y) = R(x,y) - C(x,y) \) and maximize it.
          </p>
        </div>
      </section>

      <!-- Problem 8 Solution -->
      <section data-topic="Problem 8 Solution">
        <h3>Solution: Problem 8</h3>
        <div class="formula-box" style="margin-bottom: 20px;">
           $$ P(x,y) = (4x + 5y) - (x^2 - 3xy + 9y^2 + 3x - 34y - 2) $$
           $$ P(x,y) = -x^2 + 3xy - 9y^2 + x + 39y + 2 $$
        </div>
        <div class="two-col" style="max-width:950px; margin:0 auto;">
           <div>
             <p class="small-text"><strong>Partials:</strong></p>
             <div class="small-text">
               \( P_x = -2x + 3y + 1 = 0 \) <br>
               \( P_y = 3x - 18y + 39 = 0 \)
             </div>
             <p class="small-text"><strong>Solve System:</strong></p>
             <div class="small-text">
               From \(P_x = 0\): \( -2x + 3y + 1 = 0 \Rightarrow 2x - 3y = 1.\) <br>
               From \(P_y = 0\): \( 3x - 18y + 39 = 0 \Rightarrow x - 6y = -13.\)
               <br><br>
               Solve by substitution: from the second equation \(x = 6y - 13\). Substitute into the first:
               \[
                 2(6y - 13) - 3y = 1
                 \Rightarrow 12y - 26 - 3y = 1
                 \Rightarrow 9y - 26 = 1
                 \Rightarrow 9y = 27
                 \Rightarrow y = 3.
               \]
               Then
               \[
                 x = 6(3) - 13 = 18 - 13 = 5.
               \]
               So the critical point is \((5,3)\).
             </div>
             <p class="small-text"><strong>Step 3: Check that this is a maximum.</strong></p>
             <div class="small-text">
               The second partial derivatives are:
               \[
                 P_{xx} = -2,\quad P_{yy} = -18,\quad P_{xy} = 3.
               \]
               Then
               \[
                 D = P_{xx}P_{yy} - (P_{xy})^2 = (-2)(-18) - 3^2 = 36 - 9 = 27 &gt; 0,
               \]
               and \(P_{xx} = -2 &lt; 0\). So by the D-test, \((5,3)\) is a <strong>relative maximum</strong>.
             </div>
             <p class="small-text">
               Finally, compute the profit at this point. It is easier to use \(P = R - C\):
               \[
                 R(5,3) = 4(5) + 5(3) = 20 + 15 = 35,
               \]
               \[
                 C(5,3) = 5^2 - 3(5)(3) + 9(3)^2 + 3(5) - 34(3) - 2 = -28.
               \]
               So
               \[
                 P(5,3) = 35 - (-28) = 63.
               \]
               In context: the company should produce \(5{,}000\) units of product \(x\) and \(3{,}000\) units of product \(y\) to maximize profit, and the maximum profit is \(63\) (in the given units).
             </p>
           </div>
        </div>
      </section>

      <!-- Problem 15 -->
      <section data-topic="Problem 15">
        <h2>Problem 15: Lagrange Multipliers</h2>
        <div class="example-card">
          <h3 style="margin:0 0 6px;">Find the extremum subject to constraint</h3>
          <p style="font-size: 1.1em; text-align: center;">
            <strong>Objective:</strong> \( f(x,y) = 4x^2 + y^2 \) <br>
            <strong>Constraint:</strong> \( 3x + 3y = 90 \)
          </p>
        </div>
        <div class="callout">
          <p style="margin:0">
            <strong>Strategy:</strong> <br>
            Simplify constraint: \( x + y = 30 \). <br>
            Set up \( F(x,y,\lambda) = 4x^2 + y^2 - \lambda(x + y - 30) \).
          </p>
        </div>
      </section>

      <!-- Problem 15 Solution -->
      <section data-topic="Problem 15 Solution">
        <h3>Solution: Problem 15</h3>
        <div class="two-col" style="max-width:950px; margin:0 auto; gap:20px;">
          <div class="example-card">
            <h4 style="margin:0;">Derivatives</h4>
            <div class="small-text">
               $$ F_x = 8x - \lambda = 0 \Rightarrow \lambda = 8x $$
               $$ F_y = 2y - \lambda = 0 \Rightarrow \lambda = 2y $$
               $$ F_\lambda = -(x + y - 30) = 0 $$
            </div>
          </div>
          <div class="example-card">
            <h4 style="margin:0;">Solving</h4>
            <div class="small-text">
               Set lambdas equal:
               $$ 8x = 2y \Rightarrow y = 4x $$
               Substitute into constraint:
               $$ x + (4x) = 30 $$
               $$ 5x = 30 \Rightarrow x = 6 $$
               $$ y = 4(6) = 24 $$
               <br>
               <strong>Point:</strong> \((6, 24)\) <br>
               <strong>Value:</strong> \(4(6^2) + 24^2 = 144 + 576 = 720\) (Minimum)
            </div>
            <p class="small-text" style="margin-top:10px;">
              Why is this a minimum? The function \(f(x,y) = 4x^2 + y^2\) is a sum of squares, so it is always
              nonnegative and grows larger as \((x,y)\) moves away from the origin. The constraint \(x + y = 30\)
              is a straight line. On that line, the point \((6,24)\) is the one closest to the origin, so it makes
              \(4x^2 + y^2\) as small as possible. There is no maximum value on this line because you can move
              farther and farther away along the line and make \(4x^2 + y^2\) grow without bound.
            </p>
          </div>
        </div>
      </section>

      <!-- Problem 23 -->
      <section data-topic="Problem 23">
        <h2>Problem 23: Geometric Optimization</h2>
        <div class="example-card">
          <h3 style="margin:0 0 6px;">Cylindrical Can</h3>
          <p class="small-text">
            A cylindrical can has a volume of \( 250\pi \text{ cm}^3 \). <br>
            What dimensions yield the <strong>minimum surface area</strong>?
          </p>
        </div>
        <div class="two-col" style="max-width:950px; margin:10px auto;">
           <div>
             <div class="formula-box">
               Objective (Minimize Area): <br>
               \( S = 2\pi r^2 + 2\pi r h \)
             </div>
           </div>
           <div>
             <div class="formula-box">
               Constraint (Fixed Volume): <br>
               \( \pi r^2 h = 250\pi \Rightarrow r^2 h = 250 \)
             </div>
           </div>
        </div>
      </section>

      <!-- Problem 23 Solution -->
      <section data-topic="Problem 23 Solution">
        <h3>Solution: Problem 23</h3>
        <div class="small-text" style="max-width: 900px; margin: 0 auto;">
           Lagrange Function:
           \[
             F(r,h,\lambda) = 2\pi r^2 + 2\pi r h - \lambda(r^2 h - 250).
           \]
           Here \(2\pi r^2 + 2\pi r h\) is the surface area we want to minimize, and \(r^2 h = 250\) is the volume
           constraint written without \(\pi\).
        </div>
        <div class="two-col" style="max-width:950px; margin:10px auto; gap:20px;">
           <div class="example-card">
             <h4 style="margin:0;">System</h4>
             <div class="small-text">
                1) \( F_r = 4\pi r + 2\pi h - \lambda(2rh) = 0 \) <br>
                2) \( F_h = 2\pi r - \lambda(r^2) = 0 \) <br>
                3) \( r^2 h = 250 \)
             </div>
           </div>
           <div class="example-card">
             <h4 style="margin:0;">Algebra</h4>
             <div class="small-text">
                From (2): \( \lambda = \frac{2\pi r}{r^2} = \frac{2\pi}{r} \) <br>
                Sub into (1): <br>
                \( 4\pi r + 2\pi h - (\frac{2\pi}{r})(2rh) = 0 \) <br>
                \( 4\pi r + 2\pi h - 4\pi h = 0 \) <br>
                \( 4\pi r - 2\pi h = 0 \Rightarrow h = 2r \)
             </div>
             <p class="small-text" style="margin-top:10px;">
               The key outcome is \(h = 2r\): the height should be exactly twice the radius. This same relationship
               would also appear if we eliminated \(h\) using the volume formula and did a single-variable Calc I
               optimization, so this Lagrange Multiplier approach is consistent with the earlier method.
             </p>
           </div>
        </div>
        <div class="callout" style="text-align: center;">
          <p style="margin:0">
             Sub \( h=2r \) into constraint: \( r^2(2r) = 250 \Rightarrow 2r^3 = 250 \Rightarrow r^3 = 125 \) <br>
             <strong>Radius r = 5 cm, Height h = 10 cm</strong>
          </p>
        </div>
      </section>

    </div>
  </div>

  <!-- Reveal.js & MathJax Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/math/math.min.js"></script>
  <script>
    Reveal.initialize({
      hash: true,
      controls: true,
      progress: true,
      slideNumber: 'c/t',
      width: 1024,
      height: 768,
      margin: 0.04,
      plugins: [RevealMath.MathJax3, RevealNotes],
      mathjax3: { mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js' }
    });

    const headerTopic = document.getElementById('header-topic');
    function updateHeader(slide) {
      if (!slide || !headerTopic) return;
      const topic = slide.dataset.topic;
      if (topic) headerTopic.textContent = topic;
    }
    Reveal.on('ready', e => updateHeader(e.currentSlide));
    Reveal.on('slidechanged', e => updateHeader(e.currentSlide));
  </script>
  
  <!-- Three.js Visualizer Script -->
  <script>
    (function() {
      // Config
      const container = document.getElementById('three-container');
      if (!container) return;
      
      let width = container.clientWidth;
      let height = container.clientHeight;
      if (width === 0) width = 450; 
      if (height === 0) height = 400;

      // Scene
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xfafafa);
      
      // Camera
      const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 100);
      camera.position.set(4, 3, 5);
      camera.lookAt(0, 0, 0);
      
      // Renderer
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(width, height);
      container.appendChild(renderer.domElement);
      
      // Lights
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);
      
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(5, 10, 7);
      scene.add(dirLight);
      
      // Grid
      const gridHelper = new THREE.GridHelper(6, 20, 0xcccccc, 0xe5e5e5);
      scene.add(gridHelper);
      
      // Axes
      const axesHelper = new THREE.AxesHelper(3);
      scene.add(axesHelper);
      
      // Mesh Storage
      let currentMesh = null;
      let constraintMesh = null;
      let currentType = 'saddle';

      // 1. Resize Handler for Reveal Slides
      function handleResize() {
          const w = container.clientWidth || 450;
          const h = container.clientHeight || 400;
          if (w === 0 || h === 0) return;
          renderer.setSize(w, h);
          camera.aspect = w / h;
          camera.updateProjectionMatrix();
      }
      // Listen for slide change to trigger resize
      Reveal.on('slidechanged', event => {
          // If we entered the slide with the 3D container, resize
          if (event.currentSlide.querySelector('#three-container')) {
              setTimeout(handleResize, 50); // small delay to ensure visibility
          }
      });
      window.addEventListener('resize', handleResize);
      
      // Function to generate geometry based on Math function
      function createSurfaceMesh(type) {
         currentType = type;
         if(currentMesh) {
             scene.remove(currentMesh);
             currentMesh.geometry.dispose();
             currentMesh.material.dispose();
         }
         
         const segments = 40;
         const geometry = new THREE.PlaneGeometry(4, 4, segments, segments);
         
         const count = geometry.attributes.position.count;
         const positions = geometry.attributes.position;
         
         for(let i=0; i<count; i++) {
             const x = positions.getX(i); // Math x
             const z = positions.getY(i); // Math y (plane created in xy, so this is second coord)
             
             let y = 0; // Math z (height)
             
             if (type === 'min') {
                 // z = x^2 + y^2 (Bowl)
                 y = (x*x + z*z) * 0.4; 
             } else if (type === 'max') {
                 // z = -x^2 - y^2 (Hill)
                 y = -(x*x + z*z) * 0.4 + 2; 
             } else {
                 // z = x^2 - y^2 (Saddle)
                 y = (x*x - z*z) * 0.4;
             }
             
             positions.setZ(i, y); 
         }
         
         geometry.computeVertexNormals();
         geometry.rotateX(-Math.PI / 2);
         
         // Material
         const material = new THREE.MeshPhongMaterial({ 
             color: 0x2196F3, 
             side: THREE.DoubleSide,
             shininess: 50,
             wireframe: false,
             flatShading: false,
             opacity: 0.9,
             transparent: true
         });
         
         // Wireframe overlay
         const wireframeMat = new THREE.MeshBasicMaterial({ color: 0x1565C0, wireframe: true, transparent: true, opacity: 0.1 });
         const wireMesh = new THREE.Mesh(geometry, wireframeMat);
         
         currentMesh = new THREE.Mesh(geometry, material);
         currentMesh.add(wireMesh);
         scene.add(currentMesh);

         // Re-add constraint if checked
         if(document.getElementById('constraint-toggle').checked) {
            updateConstraint(true);
         }
      }
      
      // Function to add Constraint Cylinder
      function updateConstraint(isVisible) {
          if (constraintMesh) {
              scene.remove(constraintMesh);
              constraintMesh.geometry.dispose();
              constraintMesh.material.dispose();
              constraintMesh = null;
          }

          if (isVisible) {
              // Cylinder x^2 + z^2 = r^2 (in ThreeJS coords y is up, so x^2 + z^2 = r^2)
              // Cylinder representing x^2 + y^2 = 1.5
              const r = 1.5;
              const geometry = new THREE.CylinderGeometry(r, r, 5, 32, 1, true);
              const material = new THREE.MeshBasicMaterial({
                  color: 0xE91E63, // Pink
                  transparent: true,
                  opacity: 0.3,
                  side: THREE.DoubleSide,
                  depthWrite: false
              });
              constraintMesh = new THREE.Mesh(geometry, material);
              
              // Add a thicker ring at intersection approximation (visual aid)
              // For visualization, just a ring at y=0 or floating
              const ringGeo = new THREE.TorusGeometry(r, 0.03, 16, 100);
              const ringMat = new THREE.MeshBasicMaterial({ color: 0xE91E63 });
              const ring = new THREE.Mesh(ringGeo, ringMat);
              ring.rotation.x = Math.PI/2;
              constraintMesh.add(ring);

              scene.add(constraintMesh);
          }
      }

      // Initial Shape
      createSurfaceMesh('saddle');
      
      // Global Expose for Buttons
      window.update3DShape = function(type) {
          createSurfaceMesh(type);
          const desc = document.getElementById('shape-desc');
          if(type === 'min') desc.innerHTML = "<strong>Currently Viewing:</strong> Relative Minimum (Bowl).<br>Both principal curvatures are positive (concave up). D > 0, fxx > 0.";
          if(type === 'max') desc.innerHTML = "<strong>Currently Viewing:</strong> Relative Maximum (Hill).<br>Both principal curvatures are negative (concave down). D > 0, fxx < 0.";
          if(type === 'saddle') desc.innerHTML = "<strong>Currently Viewing:</strong> Saddle Point.<br>Curvatures have opposite signs. D < 0. Neither a peak nor a valley.";
      };

      window.toggleConstraint = function() {
          const isChecked = document.getElementById('constraint-toggle').checked;
          updateConstraint(isChecked);
      };
      
      // Animation Loop
      function animate() {
          requestAnimationFrame(animate);
          renderer.render(scene, camera);
      }
      animate();
      
      // Basic Interaction (Rotate around Y)
      let isDragging = false;
      let previousMousePosition = { x: 0, y: 0 };
      
      container.addEventListener('mousedown', function(e) {
          isDragging = true;
      });
      container.addEventListener('mousemove', function(e) {
          if(isDragging) {
              const deltaMove = {
                  x: e.offsetX - previousMousePosition.x,
                  y: e.offsetY - previousMousePosition.y
              };
              
              // Rotate Mesh
              if(currentMesh) {
                  currentMesh.rotation.y += deltaMove.x * 0.01;
                  // Limit x rotation to avoid flip
                  currentMesh.rotation.x += deltaMove.y * 0.01;
              }
              if(constraintMesh) {
                  // Keep constraint stationary or rotate with mesh? 
                  // Usually constraint is fixed in domain. 
                  // But visually it helps if it rotates with the view if the VIEW rotates.
                  // Here we are rotating the OBJECTs, not the camera.
                  // So we should rotate constraint too?
                  // Actually better to rotate the SCENE or CAMERA controls.
                  // For simplicity, let's rotate the constraint mesh too.
                  constraintMesh.rotation.y += deltaMove.x * 0.01;
                  constraintMesh.rotation.x += deltaMove.y * 0.01;
              }
          }
          previousMousePosition = {
              x: e.offsetX,
              y: e.offsetY
          };
      });
      container.addEventListener('mouseup', function(e) {
          isDragging = false;
      });
      
      // Initial resize in case loaded directly
      setTimeout(handleResize, 100);
      
    })();
  </script>

  <script>
    // ===== D-Test Visualizer =====
    (function() {
      const canvas = document.getElementById('dTestCanvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const fxxS = document.getElementById('fxxSlider');
      const fyyS = document.getElementById('fyySlider');
      const fxyS = document.getElementById('fxySlider');
      
      const fxxVal = document.getElementById('fxxVal');
      const fyyVal = document.getElementById('fyyVal');
      const fxyVal = document.getElementById('fxyVal');
      
      const resDiv = document.getElementById('dTestResult');
      const expDiv = document.getElementById('dTestExplanation');

      function draw() {
        const fxx = parseInt(fxxS.value);
        const fyy = parseInt(fyyS.value);
        const fxy = parseInt(fxyS.value);
        
        fxxVal.textContent = fxx;
        fyyVal.textContent = fyy;
        fxyVal.textContent = fxy;

        const D = (fxx * fyy) - (fxy * fxy);
        
        let classification = "Inconclusive";
        let color = "#333";
        let explanation = "";

        if (D > 0) {
            if (fxx > 0) {
                classification = "Relative Minimum";
                color = "#2E7D32"; // Green
                explanation = "D > 0 and fxx > 0. The surface curves UP in all directions (like a bowl).";
            } else if (fxx < 0) {
                classification = "Relative Maximum";
                color = "#D84315"; // Orange
                explanation = "D > 0 and fxx < 0. The surface curves DOWN in all directions (like a hill).";
            }
        } else if (D < 0) {
            classification = "Saddle Point";
            color = "#C62828"; // Red
            explanation = "D < 0. The surface curves up in one direction and down in another (like a Pringle).";
        } else {
            classification = "Inconclusive";
            color = "#555";
            explanation = "D = 0. The test fails. Higher order derivatives are needed.";
        }

        resDiv.textContent = `D = ${D} → ${classification}`;
        resDiv.style.color = color;
        expDiv.textContent = explanation;

        // Simple Visual Representation
        ctx.clearRect(0,0,360,260);
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        
        // Draw axis
        ctx.beginPath();
        ctx.strokeStyle = "#ddd";
        ctx.moveTo(180, 20); ctx.lineTo(180, 240);
        ctx.moveTo(20, 130); ctx.lineTo(340, 130);
        ctx.stroke();

        ctx.strokeStyle = color;
        ctx.beginPath();
        // Drawing a simplified curve to represent the shape profile
        if(classification.includes("Minimum")) {
             // U shape
             ctx.moveTo(100, 80);
             ctx.quadraticCurveTo(180, 200, 260, 80);
        } else if (classification.includes("Maximum")) {
             // n shape
             ctx.moveTo(100, 180);
             ctx.quadraticCurveTo(180, 60, 260, 180);
        } else if (classification.includes("Saddle")) {
             // Wave shape
             ctx.moveTo(80, 160);
             ctx.bezierCurveTo(180, 240, 180, 20, 280, 100);
        } else {
             // Flat line
             ctx.moveTo(100, 130);
             ctx.lineTo(260, 130);
        }
        ctx.stroke();
      }

      fxxS.addEventListener('input', draw);
      fyyS.addEventListener('input', draw);
      fxyS.addEventListener('input', draw);
      draw();
    })();

    // ===== Lagrange Visualizer =====
    (function() {
      const canvas = document.getElementById('lagrangeCanvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const slider = document.getElementById('contourSlider');
      const output = document.getElementById('contourVal');

      const W = canvas.width;
      const H = canvas.height;
      // Scale: 0 to 25 on axes
      const scale = W / 30; 

      function toScreen(x, y) {
          return {
              x: x * scale + 20, // margin
              y: H - (y * scale) - 20
          };
      }

      function draw() {
        const k = parseFloat(slider.value);
        output.textContent = k;
        
        ctx.clearRect(0,0,W,H);
        
        // Draw Axes
        ctx.strokeStyle = "#aaa";
        ctx.lineWidth = 1;
        ctx.beginPath();
        let origin = toScreen(0,0);
        let xEnd = toScreen(25,0);
        let yEnd = toScreen(0,25);
        ctx.moveTo(origin.x, origin.y); ctx.lineTo(xEnd.x, xEnd.y);
        ctx.moveTo(origin.x, origin.y); ctx.lineTo(yEnd.x, yEnd.y);
        ctx.stroke();
        
        // Draw Constraint Line x + y = 20 => y = 20 - x
        ctx.strokeStyle = "#1E88E5"; // Blue
        ctx.lineWidth = 3;
        ctx.beginPath();
        let start = toScreen(0, 20);
        let end = toScreen(20, 0);
        ctx.moveTo(start.x, start.y);
        ctx.lineTo(end.x, end.y);
        ctx.stroke();
        
        // Draw Contour Curve xy = k => y = k/x
        ctx.strokeStyle = "#FF9800"; // Orange
        ctx.lineWidth = 3;
        ctx.beginPath();
        let first = true;
        for(let x = 0.5; x <= 25; x += 0.5) {
            let y = k / x;
            if (y > 25) continue;
            let pos = toScreen(x, y);
            if(first) { ctx.moveTo(pos.x, pos.y); first=false; }
            else { ctx.lineTo(pos.x, pos.y); }
        }
        ctx.stroke();
        
        // Highlight Tangent Point (10, 10)
        let tanPt = toScreen(10, 10);
        ctx.fillStyle = "#333";
        ctx.beginPath();
        ctx.arc(tanPt.x, tanPt.y, 4, 0, Math.PI*2);
        ctx.fill();
        
        // Text
        ctx.fillStyle = "#333";
        ctx.font = "12px sans-serif";
        ctx.fillText("x + y = 20", toScreen(2, 18).x, toScreen(2, 18).y);
        ctx.fillStyle = "#FF9800";
        ctx.fillText(`xy = ${k}`, toScreen(22, k/22).x, toScreen(22, k/22).y);
        
        if (k == 100) {
            ctx.fillStyle = "green";
            ctx.font = "bold 14px sans-serif";
            ctx.fillText("MAXIMUM FOUND!", W/2 - 60, 40);
        }
      }
      
      slider.addEventListener('input', draw);
      draw();
    })();

    // ===== Feasible Region Visualizer =====
    (function() {
        const canvas = document.getElementById('feasibleCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;
        
        // Draw triangle region
        // 2x + 4y = 40 => x-int=20, y-int=10
        const scaleX = (W-40) / 25;
        const scaleY = (H-40) / 15;
        
        function tX(val) { return 30 + val * scaleX; }
        function tY(val) { return H - 30 - val * scaleY; }
        
        // Fill Region
        ctx.beginPath();
        ctx.moveTo(tX(0), tY(0));
        ctx.lineTo(tX(20), tY(0)); // x=20, y=0
        ctx.lineTo(tX(0), tY(10)); // x=0, y=10
        ctx.closePath();
        ctx.fillStyle = "rgba(76, 175, 80, 0.3)";
        ctx.fill();
        ctx.strokeStyle = "#2E7D32";
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Draw Axes
        ctx.beginPath();
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 1;
        ctx.moveTo(tX(0), tY(0)); ctx.lineTo(tX(25), tY(0));
        ctx.moveTo(tX(0), tY(0)); ctx.lineTo(tX(0), tY(15));
        ctx.stroke();
        
        // Labels
        ctx.fillStyle = "#000";
        ctx.font = "12px sans-serif";
        ctx.fillText("(0,0)", tX(0)-10, tY(0)+15);
        ctx.fillText("(20,0)", tX(20)-10, tY(0)+15);
        ctx.fillText("(0,10)", tX(0)-25, tY(10)+5);
        
        // Max Point (6,7) from lecture
        let px = 6; 
        let py = 7; // lies on 2(6) + 4(7) = 12 + 28 = 40. Correct.
        ctx.beginPath();
        ctx.arc(tX(px), tY(py), 5, 0, Math.PI*2);
        ctx.fillStyle = "#D32F2F";
        ctx.fill();
        ctx.fillText("Max (6,7)", tX(px)+5, tY(py)-5);
    })();
  </script>
</body>
</html>
