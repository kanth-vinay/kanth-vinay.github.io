<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>Slides on Steroids — Reveal.js Feature Demo</title>

  <!-- Reveal 4.3.1 (projector-tested) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reset.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/serif.min.css" id="theme">
  <!-- Optional syntax highlight theme -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/monokai.min.css">

  <!-- Markmap + KaTeX (for Conics mindmap) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.15.5"></script>
  <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.15.5"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- ===== Projector-friendly custom CSS (older 4:3 screens) ===== -->
  <style>
    :root{
      --r-main-font-size: 32px;
      --header-h: 72px;
      --footer-h: 44px;
      --frame-pad: 18px;
    }

    /* Typography / layout */
    body{ font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .reveal h1,.reveal h2,.reveal h3{ text-transform:none; letter-spacing:.2px; }
    .left-align{ text-align:left; }
    .small-text{ font-size:.75em; }
    .sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }

    /* Pills */
    .pill-row{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    .pill{
      padding:6px 10px; border-radius:999px; background:#1A237E; color:#fff; font-weight:600;
      font-size:.7em; border:1px solid #0f154d;
    }

    /* Hamburger + TOC */
    .hamburger{
      position: fixed;
      top: 10px; /* Aligned with header padding */
      left: 18px;
      z-index: 70; /* Above header/footer */
      font-size:26px; color:#fff; cursor:pointer; user-select:none;
      padding: 8px;
    }
    body[data-theme="dark"] .hamburger { color: #111; }


    .toc-panel{
      position: fixed; top:0; left:0; height:100%; width:320px; max-width:80vw;
      background:#fff; box-shadow: 0 0 0 1px rgba(0,0,0,.05), 6px 0 20px rgba(0,0,0,.15);
      transform: translateX(-100%); transition: transform .25s ease; z-index:55;
      padding:18px 16px 24px; overflow-y:auto;
    }
    .toc-panel.open{ transform: translateX(0); }
    .toc-panel h3{ margin:0 0 10px; font-size:.9em; letter-spacing:.02em; }
    .toc-panel ul{ list-style:none; margin:0; padding:0; }
    .toc-panel li{ margin:6px 0; }
    .toc-panel a{
      display:block; padding:8px 10px; border-radius:8px; text-decoration:none;
      color:#1A237E; background:#F5F7FF; border:1px solid #E6E9F9; font-size:.8em;
    }
    .toc-panel a:hover{ background:#EBEEFF; }
    .toc-backdrop{
      position: fixed; inset:0; background:rgba(0,0,0,.2); backdrop-filter:blur(1px);
      z-index:54; opacity:0; pointer-events:none; transition:opacity .2s ease;
    }
    .toc-backdrop.show{ opacity:1; pointer-events:auto; }

    .graph-container{
      margin: 10px auto; padding: 15px; background:#f9f9f9;
      border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    /* Iframe interaction helpers */
    .iframe-veil{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.85); border-radius:8px; cursor:pointer; z-index:2; }
    body[data-theme="dark"] .iframe-veil{ background:rgba(0,0,0,0.6); color:#fff; }
    .iframe-exit{ position:absolute; top:8px; right:8px; z-index:3; border:1px solid #cbd5e1; background:#fff; border-radius:999px; padding:6px 10px; font-size:12px; cursor:pointer; display:none; }
    body[data-theme="dark"] .iframe-exit{ background:#111; color:#fff; border-color:#444; }

    /* Utilities */
    .utils{ position: fixed; right:18px; bottom:18px; z-index:70; display:flex; gap:8px; }
    .utils button{
      border:1px solid #cbd5e1; background:#fff; border-radius:999px; padding:8px 12px; font-size:12px; cursor:pointer;
      box-shadow:0 1px 4px rgba(0,0,0,.08);
    }
    .utils button:focus{ outline:2px solid #1A237E; outline-offset:2px; }
    .skiplink{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skiplink:focus{ position:static; width:auto; height:auto; padding:6px 10px; background:#fff; border:1px solid #1A237E; }

    /* Callout */
    .callout{ border-left:6px solid #4CAF50; background:#F5F7FF; padding:12px 16px; border-radius:8px; text-align:left; }

    /* Flip-cards */
    .deck{ display:grid; grid-template-columns: repeat(3,1fr); gap:16px; }
    .card{ perspective:1000px; }
    .card-inner{
      position:relative; transform-style:preserve-3d; transition: transform .6s;
      border:1px solid #e5e7eb; border-radius:16px; padding:16px; min-height:120px; background:#fff;
    }
    .card.flipped .card-inner{ transform: rotateY(180deg); }
    .card-face{
      position:absolute; inset:0; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; text-align:center; padding:16px;
    }
    .card-back{ transform: rotateY(180deg); background:#F5F7FF; }

    /* Poll */
    .poll{ display:flex; flex-direction:column; gap:12px; }
    .poll button{ border:1px solid #cbd5e1; background:#fff; border-radius:12px; padding:8px 12px; cursor:pointer; font-weight:600; }
    .poll .bar{ height:10px; background:linear-gradient(90deg,#1A237E,#4CAF50); border-radius:999px; }
    .poll .options { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }

    /* Dice */
    .dice-container{ display:flex; gap:20px; margin:10px 0; }
    .die{ width:60px; height:60px; border:2px solid #333; border-radius:10px; padding:5px; display:grid; grid-template: repeat(3,1fr)/repeat(3,1fr); }
    .die.rolling{ animation: roll .5s ease-out; }
    @keyframes roll{
      0%{ transform: rotate(0) scale(1) } 25%{ transform: rotate(15deg) scale(1.1) translateX(5px) }
      50%{ transform: rotate(-15deg) scale(1.1) translateX(-5px) } 100%{ transform: rotate(0) scale(1) }
    }
    .pip{ width:12px; height:12px; background:#333; border-radius:50%; align-self:center; justify-self:center; }

    /* Derivative viz container */
    .viz{ border:1px solid #e5e7eb; border-radius: 12px; padding: 12px; background: #fff; }

    /* Color-coded math ops (with non-color cues) */
    .op{ padding:2px 6px; border-radius:6px; font-weight:700; }
    .op-add{ background:#E6F4EA; border:1px solid #9AD0A5; }
    .op-sub{ background:#FFE8E6; border:1px solid #FFB3AB; }
    .op-mul{ background:#E7F0FF; border:1px solid #A9C7FF; }
    .op-div{ background:#FFF7D6; border:1px solid #FFE38A; }

    /* Whiteboard */
    .whiteboard{ position:fixed; inset:0; z-index:80; cursor:crosshair; display:none; }
    .whiteboard.show{ display:block; }
    .wb-hint{
      position:fixed; top:20px; left:50%; transform:translateX(-50%);
      background:rgba(0,0,0,.7); color:#fff; padding:8px 14px; border-radius:999px;
      font-size:.8em; z-index:85; display:none; pointer-events:none;
    }
    .wb-hint.show{ display:block; }

    .legend{ display:flex; gap:12px; justify-content:center; font-size:.7em; margin-top:6px; }
    .legend i{ width:12px; height:12px; border-radius:3px; display:inline-block; border:1px solid #cbd5e1; }

    /* MathJax class helpers for color-coded algebra */
    .mjx-container .cancel{ text-decoration: line-through 3px solid #C62828; }
    .math-steps{ text-align:left; max-width:900px; margin:0 auto; }
    .math-steps .step{ margin:6px 0; }

    /* Markmap sizing inside a slide */
    .markmap-wrap{ width:100%; height:520px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; }
    .markmap-wrap svg{ width:100%; height:100%; display:block; }

    /* Dark theme contrast for pills */
    body[data-theme="dark"] .pill {
      background:#FFFFFF; color:#111; border-color:#e5e7eb;
    }

    /* Spotlight effect (toggle with 'L') */
    .spotlight::after{
      content:''; position:fixed; inset:0; pointer-events:none;
      background: radial-gradient(circle 120px at var(--x,50%) var(--y,50%), transparent 0 120px, rgba(0,0,0,.55) 130px);
      z-index:65;
    }

    /* ===== Hypothesis Testing Tier Rows (two-column) ===== */
    .tier{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; align-items:start; }
    .tier .pane{ border:1px solid #e5e7eb; background:#fff; border-radius:12px; padding:10px; max-height:480px; overflow:auto; }
    .tier .left .row{ display:flex; flex-direction:column; gap:10px; }
    .tier .card-exp{ border:1px solid #cbd5e1; background:#fff; border-radius:12px; padding:10px 12px; cursor:grab; user-select:none; }
    .tier .card-exp:active{ cursor:grabbing; }
    .tier .card-exp.dragging { opacity: 0.5; }
    .bins{ display:grid; grid-template-rows: repeat(4, minmax(90px, auto)); gap:10px; }
    .bin{ min-height:90px; border:2px dashed #cbd5e1; border-radius:12px; padding:8px; background:#F9FAFB; }
    .bin.highlight{ outline:3px solid #4CAF50; background:#F0FFF4; }
    .bin .slot{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; min-height: 60px; /* ensure slot is droppable */ }
    .bin .slot.drag-target { background: #F0FFF4; border: 2px dashed #4CAF50; border-radius: 8px; }
    .tier .left .row.drag-target {
        outline: 2px dashed #4CAF50;
        background: #F0FFF4;
        border-radius: 12px;
        min-height: 100px;
    }
    .send-btns{ display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
    .send-btns button{ border:1px solid #cbd5e1; background:#fff; border-radius:999px; padding:4px 8px; font-size:.7em; }

    /* === NEW LAYOUT: Header, Footer, Body === */
    #page-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-h);
      background-color: #1A237E;
      color: #fff;
      padding: 0 var(--frame-pad) 0 60px; /* Adjusted left padding */
      font-size: 0.9em;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 60;
      box-sizing: border-box;
    }

    #page-footer {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: var(--footer-h);
      background-color: #1A237E;
      color: #fff;
      padding: 0 var(--frame-pad);
      font-size: 0.75em;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 60;
      box-sizing: border-box;
    }

    #header-author { font-size: 1.25em; font-weight: 800; letter-spacing: .2px; }
    
    .reveal {
        /* This makes the reveal container fit between the header and footer */
        height: calc(100vh - var(--header-h) - var(--footer-h));
        margin-top: var(--header-h);
    }

    .reveal .controls, .reveal .progress {
      z-index: 65; /* Ensure controls are above footer */
    }

    /* Print Watermark & Layout */
    @media print {
      body::after {
        content: "VK · University of Missouri Saint Louis";
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 10px;
        color: rgba(0, 0, 0, 0.25);
        z-index: 100;
      }
      #page-header, #page-footer { display: none !important; }
      .reveal { margin-top: 0; height: 100vh; } /* Reset for printing */
    }
  </style>
</head>

<body>
  <!-- GLOBAL HEADER AND FOOTER -->
  <header id="page-header">
    <span id="header-author">Prof. Vinay Kanth Rao Kodipelly</span>
    <span id="header-topic">Intro</span>
  </header>
  <footer id="page-footer">
    <span>University of Missouri Saint Louis</span>
    <span>←/→ • ↓/↑ • F • S</span>
  </footer>

  <!-- Whiteboard hint element -->
  <div id="wbHint" class="wb-hint" role="status" aria-live="polite">Press W again to exit · Clear with C</div>
  
  <!-- Accessibility + Utilities -->
  <a class="skiplink" href="#start">Skip to slide content</a>
  <div class="utils" aria-label="Utility controls">
    <button id="contrastToggle" title="Toggle dark/light mode" aria-pressed="false">Dark/Light</button>
    <button id="motionToggle" title="Reduce motion" aria-pressed="false">Reduce Motion</button>
    <button id="pdfHelp" title="How to export PDF">Export PDF</button>
    <button id="wbToggle" title="Whiteboard overlay (W)">Whiteboard</button>
  </div>

  <!-- Minimal countdown timer (copy-able pattern) -->
  <div id="timer" style="position:fixed;left:18px;bottom:calc(var(--footer-h) + 12px);z-index:70;background:#fff;border:1px solid #cbd5e1;border-radius:12px;padding:6px 10px;font-size:12px; display:flex; gap: 6px; align-items:center;">
    <button id="timerBtn" aria-pressed="false">2:00</button>
    <select id="timerSelect" aria-label="Select timer duration">
      <option value="120" selected>2 min</option>
      <option value="300">5 min</option>
      <option value="600">10 min</option>
    </select>
  </div>

  <!-- Hamburger Menu Icon -->
  <div class="hamburger" id="menu-toggle" aria-label="Open menu" title="Menu">
    <i class="fas fa-bars" aria-hidden="true"></i>
  </div>

  <!-- Slide Menu (TOC) -->
  <nav class="toc-panel" id="toc-panel" aria-label="Slide menu">
    <h3>Demo Menu</h3>
    <ul>
      <li><a data-target="intro">Intro</a></li>
      <li><a data-target="nav">Navigation &amp; Accessibility</a></li>
      <li><a data-target="pills">HTML Pills</a></li>
      <li><a data-target="calc">Calculus ▸</a></li>
      <li><a data-target="stats">Statistics ▸</a></li>
      <li><a data-target="embed">Embed a Webpage</a></li>
      <li><a data-target="poll">In-class Poll</a></li>
      <li><a data-target="conics">Conics Mindmap</a></li>
      <li><a data-target="tools">Tools & Extras</a></li>
      <li><a data-target="access">Access & Offline</a></li>
      <li><a data-target="support">Student Resources</a></li>
      <li><a data-target="equity">Representation & Bias</a></li>
      <li><a data-target="belonging">Adaptation & Belonging</a></li>
      <li><a data-target="voice">Student Voice & Artifacts</a></li>
      <li><a data-target="outcomes">Outcomes & Impact</a></li>
      <li><a data-target="spotlight">Spotlight Focus</a></li>
      <li><a data-target="thanks">Thanks ▸</a></li>
    </ul>
  </nav>
  <div class="toc-backdrop" id="toc-backdrop"></div>

  <!-- Reveal root -->
  <div class="reveal">
    <div class="slides" id="start">
      <!-- 1. Title -->
      <section data-menu="intro" data-topic="Intro">
        <h2>Slides on Steroids</h2>
        <h3>A Feature Tour of HTML + Reveal.js</h3>
        <div style="margin-top: 32px; font-family: monospace; text-align: right; font-size: 0.6em; line-height: 1.4;">
          <p style="margin: 0;">Prof. Vinay Kanth Rao Kodipelly</p>
          <p style="margin: 0;">Assistant Teaching Professor</p>
          <p style="margin: 0;">Department of Mathematics, Physics, Astronomy and Statistics, UMSL</p>
        </div>
        <p class="small-text" style="margin-top: 24px;">This sample deck demonstrates interactivity, accessibility, and “all-in-one” weekly hubs.</p>
        <div class="callout small-text" style="margin-top:12px;">
          ⏱ <strong>Timer:</strong> see bottom‑left. Choose a duration, then click the time (e.g., <em>2:00</em>) to start/stop. <span aria-hidden="true">⬇︎ ⬅︎</span>
        </div>
      </section>

      <!-- 2. Nav & A11y -->
      <section data-menu="nav" data-topic="Accessibility">
        <h2>Navigation &amp; Accessibility</h2>
        <div class="callout">
          <ul>
            <li>Top-left menu; <kbd>Esc</kbd> overview.</li>
            <li>Bottom-right: <strong>Dark/Light</strong>, <strong>Reduce Motion</strong>, <strong>Whiteboard</strong>.</li>
            <li>Keys: ←/→, Space, F, S, ?</li>
          </ul>
        </div>
      </section>

      <!-- 3. Pills -->
      <section data-menu="pills" data-topic="UI Patterns">
        <h2>Small HTML Pills for Topics</h2>
        <div class="pill-row" role="list" aria-label="Topic chips">
          <span class="pill" role="listitem">Limits</span>
          <span class="pill" role="listitem">Derivatives</span>
          <span class="pill" role="listitem">Integrals</span>
          <span class="pill" role="listitem">Probability</span>
          <span class="pill" role="listitem">Inference</span>
        </div>
        <p class="small-text">Use these as quick anchors or week tags. They print well and are keyboard focusable.</p>
      </section>

      <!-- 4. Calculus Parent (horizontal) -->
      <section data-menu="calc" data-topic="Calculus">
        <section>
          <h2>Calculus Examples</h2>
          <p class="small-text">Press <kbd>↓</kbd> to dive: Derivative Intuition → Anchor Problem → Difference Quotient. Press <kbd>→</kbd> for Statistics when done.</p>
          <div class="callout small-text" style="margin-top:8px;">
            Press <kbd>↓</kbd> to open this section’s vertical slides; press <kbd>→</kbd> to continue horizontally.
          </div>
          <div class="pill-row" role="list" aria-label="Calculus topics">
            <span class="pill" role="listitem">Limits</span>
            <span class="pill" role="listitem">Derivatives</span>
            <span class="pill" role="listitem">Integrals</span>
          </div>
        </section>
        <section data-menu="deriv" data-topic="Derivatives">
          <h2>Interactive Calculus: Derivative Intuition</h2>
          <div class="viz" aria-label="Interactive graph showing secant line approaching tangent">
            <canvas id="calcCanvas" width="560" height="340" aria-describedby="calcStatus"></canvas>
            <div class="left-align small-text" id="calcStatus" aria-live="polite" style="margin-top:6px"></div>
            <div class="left-align" style="display:grid; grid-template-columns: auto 1fr; gap:8px; align-items:center; margin-top:8px;">
              <label for="func">f(x)</label>
              <select id="func" aria-label="choose function">
                <option value="x2">x²</option>
                <option value="sin">sin x</option>
                <option value="exp">eˣ</option>
              </select>
              <label for="x0">Point x₀: <output id="x0-out">0.50</output></label>
              <input id="x0" type="range" min="-2" max="2" step="0.01" value="0.5" aria-label="x zero slider" />
              <label for="h">h → 0: <output id="h-out">0.80</output></label>
              <input id="h" type="range" min="-1" max="1" step="0.01" value="0.8" aria-label="h slider" />
              <label for="show-notation">Show notation</label>
              <input id="show-notation" type="checkbox" aria-label="toggle notation">
            </div>
          </div>
        </section>
        <section data-menu="anchor" data-topic="Limits">
          <h2>Anchor Problem (Steps Hidden)</h2>
          <p class="left-align">Use a single problem as an anchor; <strong>click to reveal each step</strong> while discussing.</p>
          <div class="graph-container left-align" aria-live="polite">
            <p><strong>Problem:</strong> Compute the derivative of a simple function at a point. (Replace with your own.)</p>
            <ol id="steps" class="small-text">
              <li class="step" hidden>Step 1: Write the difference quotient.</li>
              <li class="step" hidden>Step 2: Simplify the numerator.</li>
              <li class="step" hidden>Step 3: Cancel common terms.</li>
              <li class="step" hidden>Step 4: Take the limit as h→0.</li>
              <li class="step" hidden>Step 5: State the derivative.</li>
            </ol>
            <button id="revealStepBtn" aria-controls="steps">Reveal next step</button>
          </div>
        </section>
        <section data-menu="colors" data-topic="Derivatives">
          <h2>Difference Quotient — Color-Coded Operations</h2>
          <p class="small-text">Tip: press <kbd>→</kbd> to reveal steps.</p>
          <div class="math-steps">
            <div class="step fragment left-align">Let \(f(x)=x^2\). Compute \(\dfrac{f(x+\class{op-add}{h})-f(x)}{\class{op-div}{h}}\).</div>
            <div class="step fragment left-align">\(\dfrac{(x\,\class{op-add}{+\,h})^2 - \class{cancel}{x^2}}{\class{op-div}{h}}\)</div>
            <div class="step fragment left-align">\(\dfrac{x^2\,\class{cancel}{+\,2xh + h^2} - \class{cancel}{x^2}}{\class{op-div}{h}}\) &nbsp; (expand)</div>
            <div class="step fragment left-align">\(\dfrac{\class{cancel}{x^2} \;\class{op-sub}{-}\; \class{cancel}{x^2} \;\oplus\; 2x\,\class{op-mul}{\cdot}\,h \;\oplus\; h^2}{\class{op-div}{h}}\)</div>
            <div class="step fragment left-align">\(\dfrac{\class{op-mul}{2xh} + h^2}{\class{op-div}{h}} = \class{op-mul}{2x} + h\)</div>
            <div class="step fragment left-align">As \(h\to0\), the difference quotient \(\to 2x\).</div>
          </div>
          <div class="legend" aria-label="Operation legend">
            <span><i style="background:#E7F0FF"></i> Multiply</span>
            <span><i style="background:#E6F4EA"></i> Add</span>
            <span><i style="background:#FFE8E6"></i> Subtract / Cancel</span>
            <span><i style="background:#FFF7D6"></i> Divide</span>
          </div>
        </section>
      </section>

      <!-- 5. Statistics Parent (horizontal) -->
      <section data-menu="stats" data-topic="Statistics">
        <section>
          <h2>Statistics</h2>
          <p class="small-text">Press <kbd>↓</kbd> to explore: Dice Sim → Sorter → Poll. Press <kbd>→</kbd> for Webpage Embeds.</p>
          <div class="callout small-text" style="margin-top:8px;">
            Press <kbd>↓</kbd> to open the vertical activities (Dice → Sorter → Poll); press <kbd>→</kbd> for the next major section.
          </div>
          <div class="pill-row" role="list" aria-label="Statistics topics">
            <span class="pill" role="listitem">Probability</span>
            <span class="pill" role="listitem">Inference</span>
          </div>
        </section>
        <section data-menu="dice" data-topic="Probability">
          <h2>Interactive Dice (Probability Demo)</h2>
          <p>Click to randomize and discuss outcome spaces without leaving the slide.</p>
          <div class="dice-container" role="group" aria-label="two dice">
            <div id="die1" class="die" data-value="1" aria-label="die one"></div>
            <div id="die2" class="die" data-value="1" aria-label="die two"></div>
          </div>
          <div id="dice-sum" class="results-display" aria-live="polite">Sum: 2</div>
          <div id="dice-live" class="sr-only" aria-live="polite"></div>
          <button id="roll-dice-btn">Roll Dice</button>
        </section>
        <section data-menu="htier" data-topic="Inference">
          <h2>Hypothesis Testing: Sort the Experiments</h2>
          <p class="small-text">Drag cards into the correct test bin. Or use the quick-send buttons on each card. <em>(Local only)</em></p>
          <div class="tier" aria-label="hypothesis testing sorter">
            <div class="pane left">
              <div class="row" id="exp-row" role="list">
                <div class="card-exp" role="listitem" draggable="true" tabindex="0" data-exp="large-n-mean-known-sd">
                  Large n, test mean, σ known
                  <div class="send-btns">
                    <button data-send="z">→ Z</button> <button data-send="t1">→ t (1-s)</button> <button data-send="t2">→ t (2-s)</button> <button data-send="tp">→ Paired t</button>
                  </div>
                </div>
                <div class="card-exp" role="listitem" draggable="true" tabindex="0" data-exp="small-n-unknown-sd">
                  Small n, test mean, σ unknown & normal-ish
                  <div class="send-btns">
                    <button data-send="z">→ Z</button> <button data-send="t1">→ t (1-s)</button> <button data-send="t2">→ t (2-s)</button> <button data-send="tp">→ Paired t</button>
                  </div>
                </div>
                <div class="card-exp" role="listitem" draggable="true" tabindex="0" data-exp="two-independent-means">
                  Two independent samples, means
                  <div class="send-btns">
                    <button data-send="z">→ Z</button> <button data-send="t1">→ t (1-s)</button> <button data-send="t2">→ t (2-s)</button> <button data-send="tp">→ Paired t</button>
                  </div>
                </div>
                <div class="card-exp" role="listitem" draggable="true" tabindex="0" data-exp="paired-before-after">
                  Before/After on same subjects
                  <div class="send-btns">
                    <button data-send="z">→ Z</button> <button data-send="t1">→ t (1-s)</button> <button data-send="t2">→ t (2-s)</button> <button data-send="tp">→ Paired t</button>
                  </div>
                </div>
                <div class="card-exp" role="listitem" draggable="true" tabindex="0" data-exp="proportion-large-n">
                  Proportion, large n
                  <div class="send-btns">
                    <button data-send="z">→ Z</button> <button data-send="t1">→ t (1-s)</button> <button data-send="t2">→ t (2-s)</button> <button data-send="tp">→ Paired t</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="pane right">
              <div class="bins" role="list" aria-label="test bins">
                <div class="bin" data-bin="z" aria-label="Z-Test bin" role="listitem">
                  <h4>Z-Test</h4>
                  <div class="slot" id="bin-z"></div>
                </div>
                <div class="bin" data-bin="t1" aria-label="One-sample t-Test bin" role="listitem">
                  <h4>t-Test (1-sample)</h4>
                  <div class="slot" id="bin-t1"></div>
                </div>
                <div class="bin" data-bin="t2" aria-label="Two-sample t-Test bin" role="listitem">
                  <h4>t-Test (2-sample)</h4>
                  <div class="slot" id="bin-t2"></div>
                </div>
                <div class="bin" data-bin="tp" aria-label="Paired t-Test bin" role="listitem">
                  <h4>Paired t-Test</h4>
                  <div class="slot" id="bin-tp"></div>
                </div>
              </div>
            </div>
          </div>
          <div id="htier-live" class="sr-only" aria-live="polite"></div>
          <p class="small-text">Reset with <kbd>Shift</kbd> + <kbd>T</kbd>.</p>
        </section>
        <section data-menu="quick-poll" data-topic="Statistics">
          <h2>Quick Activity — Your Call</h2>
          <div class="callout" style="text-align:left; max-width: 900px; margin: 1em auto 0;">
            <p>Replace this line with a short prompt for the in-class activity.</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; margin-top: 12px;">
              <!-- LEFT: Poll -->
              <div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px; background: #fff;">
                <h4>Your Call</h4>
                <div class="poll" data-poll-id="poll-quick-activity">
                  <div class="options">
                    <button data-choice="A">Option A</button>
                    <button data-choice="B">Option B</button>
                    <button data-choice="C">Option C</button>
                  </div>
                  <div class="results" style="font-size: 0.8em; margin-top: 12px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">A: <div style="flex: 1; background: #eee; border-radius: 999px; height: 10px;"><div class="bar" id="bar-A" style="width:0%; height: 100%;"></div></div></div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">B: <div style="flex: 1; background: #eee; border-radius: 999px; height: 10px;"><div class="bar" id="bar-B" style="width:0%; height: 100%;"></div></div></div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">C: <div style="flex: 1; background: #eee; border-radius: 999px; height: 10px;"><div class="bar" id="bar-C" style="width:0%; height: 100%;"></div></div></div>
                    <div aria-live="polite" id="poll-announce" class="sr-only"></div>
                  </div>
                </div>
              </div>
              <!-- RIGHT: Flip card -->
              <div class="card" role="button" aria-label="Flip to reveal discussion">
                <div class="card-inner">
                  <div class="card-face" style="background:#f5f7ff;">
                    <strong>Reveal discussion / answer</strong><br/>
                    <span class="small-text">Click / tap to flip</span>
                  </div>
                  <div class="card-face card-back">
                    <p>Replace this with your explanation, solution, or next-step prompt.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- 6. Embed a Webpage -->
      <section data-menu="embed" data-topic="Embeds">
        <h2>Embed a Webpage (No New Tabs)</h2>
        <p class="small-text">Bring external tools directly into the slide. Example below uses Desmos.</p>
        <div class="graph-container" style="position:relative;">
          <div class="iframe-veil" role="button" aria-label="Activate embedded page" tabindex="0">
            <div class="small-text" style="text-align:center;">
              Click to interact with Desmos.<br/>Press <kbd>Esc</kbd> or the <em>Exit Embed</em> button to return to slide navigation.
            </div>
          </div>
          <button class="iframe-exit" type="button" aria-label="Exit Embed (return to slide navigation)">Exit Embed</button>
          <iframe title="Desmos Calculator" aria-label="Embedded Desmos graphing calculator"
                  src="https://www.desmos.com/calculator?lang=en-US"
                  style="width:100%; height:420px; border:0; border-radius:8px;"
                  sandbox="allow-scripts allow-same-origin allow-forms allow-presentation"
                  allowfullscreen></iframe>
        </div>
      </section>

      <!-- 7. Poll -->
      <section data-menu="poll" data-topic="Engagement">
        <h2>In-Class Poll (Local &amp; Private)</h2>
        <p>Take a quick pulse check; results are stored only in this browser via <code>localStorage</code>.</p>
        <div class="poll options" id="poll-demo" role="group" aria-label="Class poll" style="margin-bottom: 12px;">
          <button data-key="1" aria-pressed="false">Not yet</button>
          <button data-key="2" aria-pressed="false">Getting there</button>
          <button data-key="3" aria-pressed="false">Comfortable</button>
          <button data-key="4" aria-pressed="false">Could teach it</button>
        </div>
        <div class="left-align small-text" style="max-width:720px;margin:10px auto 0;">
          <div style="display:flex; gap:10px; align-items:center">
            <div style="width:140px">Not yet</div><div class="bar" data-bar="1" style="flex:1"></div><div id="count-1">0</div>
          </div>
          <div style="display:flex; gap:10px; align-items:center">
            <div style="width:140px">Getting there</div><div class="bar" data-bar="2" style="flex:1"></div><div id="count-2">0</div>
          </div>
          <div style="display:flex; gap:10px; align-items:center">
            <div style="width:140px">Comfortable</div><div class="bar" data-bar="3" style="flex:1"></div><div id="count-3">0</div>
          </div>
          <div style="display:flex; gap:10px; align-items:center">
            <div style="width:140px">Could teach it</div><div class="bar" data-bar="4" style="flex:1"></div><div id="count-4">0</div>
          </div>
          <p class="small-text">Reset with <kbd>Shift</kbd> + <kbd>R</kbd>.</p>
        </div>
        <div id="poll-live" class="sr-only" aria-live="polite"></div>
      </section>

      <!-- 8. Conics Mindmap -->
      <section data-menu="conics" data-topic="Conics">
        <h2>Conics Mindmap</h2>
        <p class="small-text">Click nodes to expand. Collapsible, keyboard-friendly (Tab → Enter).</p>
        <div class="markmap-wrap">
          <svg id="mm-svg"></svg>
        </div>
        <script type="text/template" id="mm-data">
# Conic Sections

## Parabola
- **Definition:** Set of points equidistant from a focus (point) and a directrix (line).
- **Vertex at Origin (0, 0)**
  - **Vertical** ($x^2 = 4py$)
    - Opens Up ($p > 0$) / Down ($p < 0$)
    - Focus: $(0, p)$
    - Directrix: $y = -p$
    - Axis: $x = 0$
  - **Horizontal** ($y^2 = 4px$)
    - Opens Right ($p > 0$) / Left ($p < 0$)
    - Focus: $(p, 0)$
    - Directrix: $x = -p$
    - Axis: $y = 0$
- **Vertex at (h, k)**
  - **Vertical** ($(x - h)^2 = 4p(y - k)$)
    - Focus: $(h, k + p)$, Directrix: $y = k - p$
  - **Horizontal** ($(y - k)^2 = 4p(x - h)$)
    - Focus: $(h + p, k)$, Directrix: $x = h - p$

## Circle
- $(x - h)^2 + (y - k)^2 = r^2$
- Center $(h, k)$, Radius $r$

## Ellipse
- $\dfrac{(x - h)^2}{a^2} + \dfrac{(y - k)^2}{b^2} = 1$
- $c^2 = a^2 - b^2$, Foci $(h \pm c, k)$ or $(h, k \pm c)$

## Hyperbola
- $\dfrac{(x - h)^2}{a^2} - \dfrac{(y - k)^2}{b^2} = 1$
- $c^2 = a^2 + b^2$, Asymptotes $y-k = \pm \tfrac{b}{a}(x-h)$
        </script>
      </section>

      <!-- 9. Merged: Whiteboard, Code, Print -->
      <section data-menu="tools" data-topic="Tools">
        <h2>Tools &amp; Extras</h2>
        <div class="callout">
          <ul class="left-align">
            <li><strong>Whiteboard:</strong> Press <kbd>W</kbd> to sketch over slides. Press <kbd>C</kbd> to clear.</li>
            <li><strong>Code Highlight:</strong> Use <code>&lt;pre&gt;&lt;code&gt;</code> blocks for syntax highlighting.</li>
            <li><strong>Print to PDF:</strong> Press <kbd>P</kbd>. Enable "Background graphics" and set margins to "None".</li>
            <li><strong>More:</strong> Search slides (<kbd>Ctrl/⌘</kbd>+<kbd>F</kbd>), zoom (<kbd>Alt</kbd>+click).</li>
          </ul>
        </div>
        <pre><code class="language-js" style="margin-top:1em; width:100%;">
// Drop-in calculation right in the slide
const mean = arr => arr.reduce((a,b)=>a+b,0)/arr.length;
console.log(mean([2,4,9])); // 5
        </code></pre>
      </section>

      <!-- 10. New: Spotlight -->
      <section data-menu="spotlight" data-topic="Tools">
        <h2>Spotlight Focus</h2>
        <p>Press <kbd>L</kbd> to toggle a spotlight effect on the slide.</p>
        <p class="small-text">Once activated, move your mouse to guide your audience's focus. This is great for highlighting specific parts of a complex diagram or text without annotations.</p>
        <p class="small-text">Press <kbd>L</kbd> again to turn it off.</p>
      </section>

      <!-- A. Access & Offline -->
      <section data-menu="access" data-topic="Access & Offline">
        <h2>Access &amp; Offline Paths</h2>
        <div class="callout left-align">
          <ul>
            <li><strong>No‑internet plan:</strong> Every interactive element has a static, printable equivalent. Use <kbd>P</kbd> → enable <em>Background graphics</em> → <em>Margins: None</em>.</li>
            <li><strong>Low‑bandwidth:</strong> Use the <em>serif</em> theme (Light) and avoid embedded pages. Desmos panel can be closed; graphs are described in text.</li>
            <li><strong>Alt formats:</strong> PDF exported from this deck; MathJax renders as text in print; keyboard‑only navigation supported.</li>
          </ul>
          <p class="small-text">Note: If a student cannot use the browser interactives, I mirror the activity orally and accept paper responses.</p>
        </div>
      </section>

      <!-- B. Student Resources -->
      <section data-menu="support" data-topic="Student Resources">
        <h2>Student Resources &amp; Support</h2>
        <div class="callout left-align">
          <ul>
            <li><strong>Tutoring &amp; Math Help:</strong> Times and locations posted in Canvas. Bring this slide deck; we’ll mark problem spots.</li>
            <li><strong>Accessibility:</strong> Contact Disability Access Services for accommodations. All activities have keyboard, screen‑reader, and print alternatives.</li>
            <li><strong>Well‑being:</strong> Counseling services and basic needs support are confidential and free to students.</li>
            <li><strong>Technology loaners:</strong> If device/Internet is a barrier, I can coordinate campus options; all activities have offline equivalents.</li>
          </ul>
          <p class="small-text">Tip: add campus URLs/QR codes here for your section. Keep this slide in every weekly hub.</p>
        </div>
      </section>

      <!-- C. Representation & Bias -->
      <section data-menu="equity" data-topic="Representation & Bias">
        <h2>Representation &amp; Human Bias in Data</h2>
        <div class="callout left-align">
          <p><strong>Why it matters:</strong> Inference depends on who is sampled and what is measured. Datasets can under‑represent groups, changing conclusions.</p>
          <ul>
            <li><strong>Example prompt:</strong> "A clinical study sampled only adults aged 20–40. What biases might affect a t‑test on blood pressure?"</li>
            <li><strong>Practice:</strong> We compare two proportion examples: (a) women’s sports attendance; (b) men’s. We discuss context and sampling frames.</li>
            <li><strong>Action in class:</strong> I ask students to flag assumptions on any dataset we use; we annotate the slide (Whiteboard: <kbd>W</kbd>).</li>
            <li><strong>Diverse contexts:</strong> Data sets rotate across health, finance, sports, and community issues so more students see their experiences reflected.</li>
          </ul>
          <p class="small-text">This slide makes bias checks explicit and visible for the award rubric.</p>
        </div>
      </section>

      <!-- D. Adaptation & Belonging -->
      <section data-menu="belonging" data-topic="Belonging">
        <h2>How Live Feedback Shapes Today’s Lesson</h2>
        <div class="callout left-align">
          <ul>
            <li><strong>Real‑time adaptation:</strong> I watch the in‑deck polls. If <em>Not yet</em> &gt; 40%, we slow down and add a worked example; if <em>Comfortable</em> &gt; 60%, we jump to applications.</li>
            <li><strong>Belonging moves:</strong> Pair‑share after dice experiments; shout‑outs added to the whiteboard so student ideas are visible.</li>
            <li><strong>Transparency:</strong> I narrate what changed: "Because 18 of you chose ‘Not yet’, we’ll spend 5 minutes on the h→0 intuition."</li>
          </ul>
          <p class="small-text">Rubric tie‑in: centers student voice, shows responsiveness, and builds community norms.</p>
        </div>
      </section>

      <!-- E. Student Voice & Artifacts -->
      <section data-menu="voice" data-topic="Student Voice">
        <h2>Student Voice &amp; Artifacts</h2>
        <div class="callout left-align">
          <p><strong>Exit Ticket (saved locally):</strong> What is one idea you’ll use on the next problem set? You can sign or post anonymously. Results stay in this browser.</p>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items:start;">
            <div style="border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fff;">
              <label class="small-text" for="sv-name">Name (optional)</label>
              <input id="sv-name" type="text" placeholder="Your name (optional)" style="width:100%; margin:6px 0 10px; padding:8px; border:1px solid #cbd5e1; border-radius:8px;">
              <label class="small-text" for="sv-text">Your takeaway / artifact</label>
              <textarea id="sv-text" rows="4" placeholder="e.g., I’ll use the h→0 slider to check my algebra; derivative at x=..." style="width:100%; margin:6px 0 10px; padding:8px; border:1px solid #cbd5e1; border-radius:8px;"></textarea>
              <button id="sv-submit" style="border:1px solid #cbd5e1; background:#fff; border-radius:10px; padding:8px 12px; cursor:pointer;">Post to Gallery</button>
              <button id="sv-export" style="border:1px solid #cbd5e1; background:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; margin-left:6px;">Export JSON</button>
              <div id="sv-live" class="sr-only" aria-live="polite"></div>
              <p class="small-text" style="margin-top:8px;">Rubric tie‑in: centers student voice; creates reusable artifacts for future classes.</p>
            </div>
            <div style="border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fff;">
              <h4 style="margin-top:0;">Gallery (local)</h4>
              <div id="sv-gallery" style="display:grid; grid-template-columns: 1fr; gap:8px; max-height:340px; overflow:auto;"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- F. Outcomes & Impact -->
      <section data-menu="outcomes" data-topic="Outcomes & Impact">
        <h2>Outcomes &amp; Impact</h2>
        <div class="callout left-align">
          <p><strong>Evidence snapshot (replace with your actual numbers):</strong></p>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; align-items:start;">
            <div>
              <table class="small-text" style="width:100%; border-collapse:collapse;">
                <thead>
                  <tr><th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:6px;">Measure</th><th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:6px;">Before</th><th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:6px;">After</th></tr>
                </thead>
                <tbody>
                  <tr><td style="padding:6px; border-bottom:1px solid #f0f0f0;">Pass rate</td><td style="padding:6px;">—</td><td style="padding:6px;">—</td></tr>
                  <tr><td style="padding:6px; border-bottom:1px solid #f0f0f0;">D/F/W rate</td><td style="padding:6px;">—</td><td style="padding:6px;">—</td></tr>
                  <tr><td style="padding:6px; border-bottom:1px solid #f0f0f0;">Avg. final exam</td><td style="padding:6px;">—</td><td style="padding:6px;">—</td></tr>
                  <tr><td style="padding:6px;">Attendance (wk 6)</td><td style="padding:6px;">—</td><td style="padding:6px;">—</td></tr>
                </tbody>
              </table>
              <p class="small-text" style="margin-top:6px;">Tip: paste your numbers here. Keep one‑term baseline vs. one‑term implementation.</p>
            </div>
            <div>
              <div class="small-text" style="margin-bottom:6px;">Student feedback (anonymized):</div>
              <blockquote class="small-text" style="border-left:4px solid #4CAF50; margin:0; padding:6px 10px; background:#fff; border-radius:8px;">“The live steps and polls helped me say when I was lost without feeling called out.”</blockquote>
              <blockquote class="small-text" style="border-left:4px solid #4CAF50; margin:8px 0 0; padding:6px 10px; background:#fff; border-radius:8px;">“Being able to print the deck and annotate on paper reduced my anxiety.”</blockquote>
              <p class="small-text" style="margin-top:8px;">Peer‑to‑peer belonging: use pair‑share prompts on Dice/HTier; capture insights on the whiteboard and in the gallery.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 11. Thanks -->
      <section data-menu="thanks">
        <section data-topic="Thanks">
          <h2>That’s the Tour</h2>
          <p>Swap in your own content, keep the interactions. Happy teaching!</p>
          <div class="callout small-text" style="margin-top:10px;">
            Press <kbd>↓</kbd> for <strong>Meta &amp; Authorship</strong>.
          </div>
        </section>
        <section data-menu="meta" data-topic="Meta">
          <h2>Meta &amp; Authorship</h2>
          <div class="left-align small-text">
          <p><strong>Author:</strong> Prof. Vinay Kanth Rao Kodipelly (UMSL) — HTML + Reveal.js + custom widgets.</p>
            <ul>
              <li>Theme DNA: serif/black base with custom badges &amp; pills across slides.</li>
              <li>Reusable patterns: each widget includes a <em>Copy this pattern</em> block.</li>
              <li>Pedagogical affordances: keyboard shortcuts, live a11y announcements, minimal on‑canvas text.</li>
            </ul>
            <p class="small-text">Use, adapt, and attribute: “Slides on Steroids — Kodipelly”.</p>
          </div>
        </section>
      </section>
    </div>
  </div>

  <!-- Whiteboard canvas -->
  <canvas id="whiteboard" class="whiteboard" aria-hidden="true"></canvas>

  <!-- Reveal core + plugins -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/math/math.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/search/search.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/zoom/zoom.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/highlight.min.js"></script>

  <script>
    Reveal.initialize({
      hash: true,
      controls: true,
      progress: true,
      slideNumber: 'c/t',
      width: 1024, height: 768, margin: 0.04, minScale: 0.2, maxScale: 1.2, /* older projector screens */
      plugins: [RevealMath.MathJax3, RevealNotes, RevealSearch, RevealZoom, RevealHighlight],
      mathjax3: { mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js' },
      pdfSeparateFragments: true,
      fragments: !window.matchMedia('(prefers-reduced-motion: reduce)').matches
    });
  </script>

  <!-- ===== Feature JS: Utilities, Menu, Derivative Viz, Dice, Poll, Whiteboard, Steps, Timer, Spotlight ===== -->
  <script>
    // Dark/Light & Reduce Motion & PDF helper & Whiteboard toggle
    (function(){
      const themeEl = document.getElementById('theme');
      const contrastBtn = document.getElementById('contrastToggle');
      const motionBtn = document.getElementById('motionToggle');
      const pdfBtn = document.getElementById('pdfHelp');
      const wbBtn = document.getElementById('wbToggle');
      const wb = document.getElementById('whiteboard');
      const hamburger = document.querySelector('.hamburger');

      const THEME_KEY='slides-theme';
      // apply saved preference on load
      (function applySavedTheme(){
        const saved = localStorage.getItem(THEME_KEY);
        if(saved==='black'){
          themeEl.dataset.alt = themeEl.href;
          themeEl.href = 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/black.min.css';
          document.body.setAttribute('data-theme','dark');
          contrastBtn.setAttribute('aria-pressed','true');
          if(hamburger) hamburger.style.color = '#111';
        } else {
          document.body.setAttribute('data-theme','light');
          contrastBtn.setAttribute('aria-pressed','false');
          if(hamburger) hamburger.style.color = '#fff';
        }
      })();

      contrastBtn && contrastBtn.addEventListener('click', ()=>{
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        if(!isDark){
          themeEl.dataset.alt = themeEl.href;
          themeEl.href = 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/black.min.css';
          document.body.setAttribute('data-theme','dark');
          localStorage.setItem(THEME_KEY,'black');
          contrastBtn.setAttribute('aria-pressed','true');
          if(hamburger) hamburger.style.color = '#111';
        }else{
          const old = themeEl.dataset.alt; delete themeEl.dataset.alt; themeEl.href = old;
          document.body.setAttribute('data-theme','light');
          localStorage.setItem(THEME_KEY,'serif');
          contrastBtn.setAttribute('aria-pressed','false');
          if(hamburger) hamburger.style.color = '#fff';
        }
      });

      motionBtn && motionBtn.addEventListener('click', ()=>{
        const now = document.body.classList.toggle('reduced-motion');
        motionBtn.setAttribute('aria-pressed', String(now));
        Reveal.configure({ fragments: !now });
      });

      pdfBtn && pdfBtn.addEventListener('click', ()=>{
        alert('Print to PDF tips:\n• Press P or File → Print\n• Enable Background graphics\n• Margins: None\n• Paper: Letter or A4\n• Fragments print in order');
      });

      function setupWhiteboard(){
        if(!wb) return;
        const ctx = wb.getContext('2d');
        const hint = document.getElementById('wbHint');
        let drawing = false, lastX=0, lastY=0;

        function resize(){
          const dpr = window.devicePixelRatio || 1;
          wb.width = innerWidth * dpr; wb.height = innerHeight * dpr;
          wb.style.width = innerWidth + 'px'; wb.style.height = innerHeight + 'px';
          ctx.setTransform(1,0,0,1,0,0);
          ctx.scale(dpr, dpr);
          ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.strokeStyle = '#111'; ctx.lineWidth = 3;
        }
        window.addEventListener('resize', ()=> wb.classList.contains('show') && resize());

        function start(e){ drawing = true; const p = point(e); lastX = p.x; lastY = p.y; }
        function move(e){
          if(!drawing) return;
          const p = point(e);
          ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(p.x, p.y); ctx.stroke();
          lastX = p.x; lastY = p.y;
        }
        function end(){ drawing = false; }

        function point(e){
          const rect = wb.getBoundingClientRect();
          if(e.touches && e.touches[0]){ return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top }; }
          return { x: e.clientX - rect.left, y: e.clientY - rect.top };
        }

        wb.addEventListener('mousedown', start);
        wb.addEventListener('mousemove', move);
        wb.addEventListener('mouseup', end);
        wb.addEventListener('mouseleave', end);
        wb.addEventListener('touchstart', start, {passive:false});
        wb.addEventListener('touchmove', (e)=>{ e.preventDefault(); move(e); }, {passive:false});
        wb.addEventListener('touchend', end);

        function show(){
          wb.classList.add('show');
          resize();
          if (!localStorage.getItem('wb-hint-shown')) {
            hint.classList.add('show');
            setTimeout(() => {
              hint.classList.remove('show');
              localStorage.setItem('wb-hint-shown', 'true');
            }, 3500);
          }
        }
        function hide(){
            wb.classList.remove('show');
            if (hint) hint.classList.remove('show');
        }

        function toggle() {
          if (wb.classList.contains('show')) hide();
          else show();
        }

        wbBtn && wbBtn.addEventListener('click', toggle);
        document.addEventListener('keydown', (e)=>{
          if(e.key.toLowerCase()==='w') { e.preventDefault(); toggle(); }
          if(e.key.toLowerCase()==='c' && wb.classList.contains('show')){ ctx.clearRect(0,0,wb.width,wb.height); }
        });
      }
      setupWhiteboard();

      // Minimal countdown timer
      (function(){
        const btn=document.getElementById('timerBtn');
        const sel=document.getElementById('timerSelect');
        if(!btn || !sel) return;

        let total = parseInt(sel.value, 10) || 120;
        let t = total;
        let id = null;

        const render = ()=> btn.textContent = `${Math.floor(t/60)}:${(t%60+'').padStart(2,'0')}`;

        sel.addEventListener('change', ()=>{
          if(id){ clearInterval(id); id=null; btn.setAttribute('aria-pressed','false'); }
          total=parseInt(sel.value,10)||120;
          t=total;
          render();
        });

        btn.addEventListener('click', ()=>{
          if(id){ clearInterval(id); id=null; btn.setAttribute('aria-pressed','false'); return; }
          btn.setAttribute('aria-pressed','true');
          id=setInterval(()=>{
            t--;
            render();
            if(t<=0){
              clearInterval(id);
              id=null;
              btn.setAttribute('aria-pressed','false');
              alert('Time!');
              t=total; // Reset to selected duration
              render();
            }
          },1000);
        });
        render();
      })();

    // Spotlight focus (only on Spotlight slide, never advances slides)
    (function(){
      let on=false;
      function onSpotlightSlide(){
        const s = Reveal.getCurrentSlide();
        return s && s.dataset && s.dataset.menu === 'spotlight';
      }
      document.addEventListener('keydown', e=>{
        if((e.key === 'l' || e.key === 'L') && onSpotlightSlide()){
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          on=!on;
          document.documentElement.classList.toggle('spotlight', on);
        }
      }, true);
      document.addEventListener('mousemove', e=>{
        if(document.documentElement.classList.contains('spotlight')){
          document.documentElement.style.setProperty('--x', e.clientX+'px');
          document.documentElement.style.setProperty('--y', e.clientY+'px');
        }
      });
      // When leaving the spotlight slide, ensure spotlight is off
      Reveal.on('slidechanged', e=>{
        if(e.previousSlide && e.previousSlide.dataset.menu === 'spotlight'){
          on=false;
          document.documentElement.classList.remove('spotlight');
        }
      });
    })();

    // Click-to-activate overlay for embedded iframes (e.g., Desmos)
    (function(){
      function setupVeil(root){
        if(!root) return;
        const veil = root.querySelector('.iframe-veil');
        const frame = root.querySelector('iframe');
        const exitBtn = root.querySelector('.iframe-exit');
        if(!veil || !frame || !exitBtn) return;

        function enable(){
          veil.style.display='none';
          exitBtn.style.display='inline-block';
          frame.style.pointerEvents='auto';
          // try to focus, but do not rely on it for exit
          try{ frame.focus(); }catch(e){}
        }
        function disable(){
          veil.style.display='flex';
          exitBtn.style.display='none';
          frame.style.pointerEvents='none';
          veil.focus();
        }

        // Primary affordances
        veil.addEventListener('click', enable);
        veil.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); enable(); }});
        exitBtn.addEventListener('click', disable);

        // Smooth defocus: if the pointer leaves the embed panel, auto-exit
        let leaveTimer=null;
        root.addEventListener('mouseleave', ()=>{ leaveTimer = setTimeout(disable, 50); });
        root.addEventListener('mouseenter', ()=>{ if(leaveTimer){ clearTimeout(leaveTimer); leaveTimer=null; } });

        // Best-effort Esc: will work when parent has focus
        window.addEventListener('keydown', (e)=>{
          if(e.key === 'Escape') disable();
        });

        // Reset on navigation
        Reveal.on('slidechanged', e=>{
          const wasEmbed = e.previousSlide && e.previousSlide.dataset.menu === 'embed';
          if(wasEmbed) disable();
          const isEmbed = e.currentSlide && e.currentSlide.dataset.menu === 'embed';
          if(isEmbed) disable();
        });
        Reveal.on('ready', e=>{
          const isEmbed = e.currentSlide && e.currentSlide.dataset.menu === 'embed';
          if(isEmbed) disable();
        });

        // Default state
        disable();
      }
      const embedSection = document.querySelector('section[data-menu="embed"] .graph-container');
      setupVeil(embedSection);
    })();
    })();

    // Hamburger TOC
    (function(){
      const tocPanel = document.getElementById('toc-panel');
      const tocBackdrop = document.getElementById('toc-backdrop');
      const menuToggle = document.getElementById('menu-toggle');

      function openMenu(){ tocPanel.classList.add('open'); tocBackdrop.classList.add('show'); }
      function closeMenu(){ tocPanel.classList.remove('open'); tocBackdrop.classList.remove('show'); }

      menuToggle && menuToggle.addEventListener('click', openMenu);
      tocBackdrop && tocBackdrop.addEventListener('click', closeMenu);

      function slideIndicesForMenu(key){
        const target = document.querySelector(`section[data-menu=\"${key}\"]`);
        if(!target) return null;
        // This needs to find the PARENT slide for vertical stacks
        const parent = target.parentElement.tagName === 'SECTION' ? target.parentElement : target;
        return Reveal.getIndices(parent);
      }

      tocPanel && tocPanel.addEventListener('click', (e) => {
        const a = e.target.closest('a[data-target]');
        if(!a) return;
        const idx = slideIndicesForMenu(a.dataset.target);
        if(idx){ Reveal.slide(idx.h, idx.v || 0); }
        closeMenu();
      });

      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });
    })();

    // Dynamic Header Update
    (function() {
        const headerTopic = document.getElementById('header-topic');
        function updateHeader(slide) {
            if (!slide || !headerTopic) return;
            const topic = slide.dataset.topic;
            if (topic) {
                headerTopic.textContent = topic;
            }
        }
        Reveal.on('ready', event => updateHeader(event.currentSlide));
        Reveal.on('slidechanged', event => updateHeader(event.currentSlide));
    })();


    // Derivative canvas (multiple functions; secant → tangent)
    (function(){
      const c = document.getElementById('calcCanvas');
      if(!c) return; const ctx = c.getContext('2d');
      const x0 = document.getElementById('x0');
      const h = document.getElementById('h');
      const x0Out = document.getElementById('x0-out');
      const hOut = document.getElementById('h-out');
      const status = document.getElementById('calcStatus');
      const funcSel = document.getElementById('func');
      const showNotation = document.getElementById('show-notation');
      const W=c.width, H=c.height; const px=40; // pixels per unit
      const toX = x=> W/2 + x*px, toY = y=> H/2 - y*px;

      const funcs = {
        x2: { f:(x)=>x*x, fp:(x)=>2*x, label:'x²' },
        sin: { f:Math.sin, fp:Math.cos, label:'sin x' },
        exp: { f:Math.exp, fp:Math.exp, label:'eˣ' }
      };

      function draw(){
        const sel = funcs[funcSel.value] || funcs.x2;
        ctx.clearRect(0,0,W,H);
        // axes
        ctx.strokeStyle = '#cbd5e1'; ctx.lineWidth=1;
        ctx.beginPath(); ctx.moveTo(0,toY(0)); ctx.lineTo(W,toY(0)); ctx.moveTo(toX(0),0); ctx.lineTo(toX(0),H); ctx.stroke();
        // curve
        ctx.strokeStyle = '#1A237E'; ctx.lineWidth=2; ctx.beginPath();
        for(let x=-W/(2*px); x<=W/(2*px); x+=0.01){ const X=toX(x), Y=toY(sel.f(x)); if(x===-W/(2*px)) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);} ctx.stroke();

        const x_0 = parseFloat(x0.value), hh = parseFloat(h.value||0.0001);
        const y0v = sel.f(x_0), y1v = sel.f(x_0+hh);
        // points
        ctx.fillStyle = '#4CAF50'; ctx.beginPath(); ctx.arc(toX(x_0), toY(y0v), 4, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#D4AF37'; ctx.beginPath(); ctx.arc(toX(x_0+hh), toY(y1v), 4, 0, Math.PI*2); ctx.fill();
        // secant
        ctx.strokeStyle = '#22c55e'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(toX(x_0), toY(y0v)); ctx.lineTo(toX(x_0+hh), toY(y1v)); ctx.stroke();
        // tangent
        const m = sel.fp(x_0); const xA = x_0-2, xB = x_0+2; const yA = y0v + m*(xA-x_0), yB = y0v + m*(xB-x_0);
        ctx.strokeStyle = '#0ea5e9'; ctx.setLineDash([6,4]); ctx.beginPath(); ctx.moveTo(toX(xA), toY(yA)); ctx.lineTo(toX(xB), toY(yB)); ctx.stroke(); ctx.setLineDash([]);
        const sec = (hh === 0) ? m : (y1v-y0v)/hh;
        const base = `f(x)=${sel.label}   x₀=${x_0.toFixed(2)}   h=${hh.toFixed(2)}   secant=${(sec).toFixed(3)}   tangent=${(m).toFixed(3)}`;
        status.textContent = showNotation.checked ? `${base}   |   (f(x₀+h)-f(x₀))/h → f'(x₀)` : base;
        if(x0Out) x0Out.textContent = (+x0.value).toFixed(2);
        if(hOut) hOut.textContent = (+h.value).toFixed(2);
      }
      ['input','change'].forEach(evt=>{
        x0.addEventListener(evt, draw);
        h.addEventListener(evt, draw);
        funcSel && funcSel.addEventListener(evt, draw);
        showNotation && showNotation.addEventListener(evt, draw);
      });
      draw();
    })();

    // Dice
    (function(){
      const rollBtn = document.getElementById('roll-dice-btn');
      const die1 = document.getElementById('die1');
      const die2 = document.getElementById('die2');
      const sumEl = document.getElementById('dice-sum');

      function setDie(el, val){
        const patterns = { 1:[4], 2:[0,8], 3:[0,4,8], 4:[0,2,6,8], 5:[0,2,4,6,8], 6:[0,2,3,5,6,8] };
        el.innerHTML=''; el.setAttribute('aria-label', `die shows ${val}`);
        for(let i=0;i<9;i++) el.appendChild(document.createElement('div'));
        (patterns[val]||[]).forEach(i=>{ const pip=document.createElement('div'); pip.className='pip'; el.children[i].appendChild(pip); });
      }

      if(rollBtn){
        setDie(die1,1); setDie(die2,1);
        rollBtn.addEventListener('click', ()=>{
          die1.classList.add('rolling'); die2.classList.add('rolling');
          setTimeout(()=>{
            const v1 = Math.floor(Math.random()*6)+1, v2 = Math.floor(Math.random()*6)+1, total = v1+v2;
            setDie(die1,v1); setDie(die2,v2);
            sumEl.textContent = `Sum: ${total}`;
            const live = document.getElementById('dice-live');
            if(live) live.textContent = `Rolled ${v1} and ${v2}. Sum ${total}.`;
            die1.classList.remove('rolling'); die2.classList.remove('rolling');
          },500);
        });
      }
    })();

    // Original Poll (localStorage, Shift+R reset)
    (function(){
      const id='poll-demo', root=document.getElementById(id);
      if(!root) return;
      const storeKey='slides-poll-'+id;
      const state = JSON.parse(localStorage.getItem(storeKey)||'{}');
      const counts = {1:0,2:0,3:0,4:0, ...state};
      const render = ()=>{
        const total = Object.values(counts).reduce((a,b)=>a+b,0) || 1;
        for(const k of [1,2,3,4]){
          const w = Math.round(100*counts[k]/total);
          const bar = document.querySelector('[data-bar=\"'+k+'\"]');
          const label = document.getElementById('count-'+k);
          if(bar) bar.style.width = w+'%';
          if(label) label.textContent = counts[k];
        }
      };
      root.querySelectorAll('button[data-key]').forEach(b=>{
        b.addEventListener('click', ()=>{
          const k=b.dataset.key;
          counts[k]++; localStorage.setItem(storeKey, JSON.stringify(counts));
          render();
          const live = document.getElementById('poll-live');
          if(live){
            const labels = {1:'Not yet',2:'Getting there',3:'Comfortable',4:'Could teach it'};
            live.textContent = `Recorded vote: ${labels[k]}. Totals now ${counts[1]}, ${counts[2]}, ${counts[3]}, ${counts[4]}.`;
          }
          b.setAttribute('aria-pressed','true');
          setTimeout(()=> b.setAttribute('aria-pressed','false'), 200);
        });
      });
      document.addEventListener('keydown', (e)=>{
        if(e.key==='R' && e.shiftKey){
          for(const k of [1,2,3,4]) counts[k]=0;
          localStorage.setItem(storeKey, JSON.stringify(counts)); render();
        }
      });
      render();
    })();
    
    // New Poll Type (from template)
    (function(){
      function initPoll(pollRoot) {
        if (!pollRoot) return;
        const pollId = pollRoot.dataset.pollId;
        if (!pollId) return;

        const storeKey = 'slides-poll-' + pollId;
        const initialCounts = JSON.parse(localStorage.getItem(storeKey) || '{}');
        const counts = { A:0, B:0, C:0, ...initialCounts };
        
        function render() {
          const choices = ['A', 'B', 'C'];
          let total = 0;
          for (const choice of choices) {
              total += (counts[choice] || 0);
          }

          for (const choice of choices) {
            const count = counts[choice] || 0;
            const bar = pollRoot.querySelector(`#bar-${choice}`);
            if (bar) {
              const percentage = (total > 0) ? Math.round((count / total) * 100) : 0;
              bar.style.width = percentage + '%';
            }
          }
        }

        pollRoot.querySelectorAll('button[data-choice]').forEach(button => {
          button.addEventListener('click', () => {
            const choice = button.dataset.choice;
            if (counts.hasOwnProperty(choice)) {
              counts[choice]++;
              localStorage.setItem(storeKey, JSON.stringify(counts));
              render();
              
              const announcer = pollRoot.querySelector('#poll-announce');
              if(announcer) announcer.textContent = `Voted for ${button.textContent}.`;
            }
          });
        });
        
        render(); // Initial render on load
      }

      // Initialize all polls with a data-poll-id attribute
      document.querySelectorAll('.poll[data-poll-id]').forEach(initPoll);
    })();

    // Flip-cards
    (function(){
      document.querySelectorAll('.card').forEach(card=>{
        if (!card.querySelector('.card-inner')) return; // Only target flippable cards
        
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'button');

        const toggle=()=> card.classList.toggle('flipped');
        card.addEventListener('click', toggle);
        card.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggle(); }});
      });
    })();

    // Progressive steps (anchor problem)
    (function(){
      const btn = document.getElementById('revealStepBtn');
      const steps = document.querySelectorAll('#steps .step');
      if(!btn || !steps.length) return;
      let i = 0;
      btn.addEventListener('click', ()=>{
        if(i < steps.length) { steps[i].hidden = false; i++; }
        if(i === steps.length){ btn.disabled = true; btn.textContent = 'All steps revealed'; }
      });
    })();

    // ===== Hypothesis Tier Rows (drag & drop + quick-send) =====
    (function(){
      const expRow = document.getElementById('exp-row');
      if (!expRow) return;

      const live = document.getElementById('htier-live');
      const slots = Array.from(document.querySelectorAll('.bin .slot'));
      let draggedCard = null;

      function announce(msg) { if (live) live.textContent = msg; }
      function labelFor(k) { return ({ z: 'Z-Test', t1: 't-Test (1-sample)', t2: 't-Test (2-sample)', tp: 'Paired t-Test' })[k] || k; }

      function startDrag(e) {
        draggedCard = e.target;
        draggedCard.classList.add('dragging');
        e.dataTransfer.setData('text/plain', draggedCard.dataset.exp || '');
        e.dataTransfer.effectAllowed = 'move';
        slots.forEach(s => s.classList.add('drag-target'));
        expRow.classList.add('drag-target');
      }

      function endDrag() {
        if (draggedCard) draggedCard.classList.remove('dragging');
        draggedCard = null;
        slots.forEach(s => s.classList.remove('drag-target'));
        expRow.classList.remove('drag-target');
      }

      function makeDropTarget(el) {
        el.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
        el.addEventListener('drop', e => {
          e.preventDefault();
          e.stopPropagation();
          if (draggedCard) {
            el.appendChild(draggedCard);
            const bin = el.closest('.bin');
            const targetName = bin ? bin.querySelector('h4').textContent : 'the starting list';
            announce(`Dropped card in ${targetName}.`);
          }
        });
      }

      function wireCard(card) {
        card.setAttribute('draggable', 'true');
        card.addEventListener('dragstart', startDrag);
        card.addEventListener('dragend', endDrag);

        card.querySelectorAll('button[data-send]').forEach(btn => {
          // Avoid re-adding listeners if card is just moved
          if (btn.dataset.wired) return;
          btn.dataset.wired = 'true';
          btn.addEventListener('click', () => {
            const targetSlot = document.querySelector(`.bin[data-bin="${btn.dataset.send}"] .slot`);
            if (targetSlot) {
              targetSlot.appendChild(card);
              announce(`Moved card to ${labelFor(btn.dataset.send)}.`);
            }
          });
        });
      }

      document.querySelectorAll('.card-exp').forEach(wireCard);
      slots.forEach(makeDropTarget);
      makeDropTarget(expRow);

      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach(node => {
            if (node.nodeType === 1 && node.matches('.card-exp')) wireCard(node);
          });
        });
      });

      [expRow, ...slots].forEach(container => {
        observer.observe(container, { childList: true });
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'T' && e.shiftKey) {
          const cards = document.querySelectorAll('.bin .card-exp');
          cards.forEach(c => expRow.appendChild(c));
          announce('Reset all cards to the starting list.');
        }
      });
    })();

    // ===== Conics Mindmap using Markmap =====
    (function(){
      let mm = null; let created = false;
      function build(){
        if(created) return; created = true;
        const svg = document.getElementById('mm-svg');
        const dataEl = document.getElementById('mm-data');
        if(!svg || !dataEl || !window.markmap) return;
        const { Transformer, Markmap } = window.markmap;
        const transformer = new Transformer();
        const { root } = transformer.transform(dataEl.textContent || '');
        const opts = { initialExpandLevel: 0, spacingVertical: 15, spacingHorizontal: 65 };
        mm = Markmap.create(svg, opts, root);
      }
      Reveal.on('slidechanged', e => { if(e.currentSlide && e.currentSlide.dataset.menu==='conics') build(); });
      Reveal.on('ready', e => { if(e.currentSlide && e.currentSlide.dataset.menu==='conics') build(); });
    })();
    // ===== Student Voice & Artifacts (localStorage) =====
    (function(){
      const NAME = 'sv-name';
      const TEXT = 'sv-text';
      const SUBMIT = 'sv-submit';
      const EXPORT = 'sv-export';
      const GALLERY = 'sv-gallery';
      const LIVE = 'sv-live';
      const KEY = 'slides-sv-gallery';

      function getEls(){
        return {
          name: document.getElementById(NAME),
          text: document.getElementById(TEXT),
          submit: document.getElementById(SUBMIT),
          exporter: document.getElementById(EXPORT),
          gallery: document.getElementById(GALLERY),
          live: document.getElementById(LIVE)
        };
      }

      function load(){
        try{ return JSON.parse(localStorage.getItem(KEY) || '[]'); }
        catch(e){ return []; }
      }
      function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

      function cardHTML(item){
        const who = item.name && item.name.trim() ? item.name.trim() : 'Anonymous';
        const when = new Date(item.ts).toLocaleString();
        const txt = (item.text || '').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `<div style="border:1px solid #e5e7eb; border-radius:10px; padding:10px; background:#F9FAFB;">
                  <div style="font-weight:600;">${who}</div>
                  <div class="small-text" style="opacity:.8;">${when}</div>
                  <div style="margin-top:6px;">${txt}</div>
                </div>`;
      }

      function render(){
        const { gallery } = getEls(); if(!gallery) return;
        const items = load().slice().reverse();
        gallery.innerHTML = items.map(cardHTML).join('');
      }

      function announce(msg){ const { live } = getEls(); if(live) live.textContent = msg; }

      function wire(){
        const els = getEls();
        if(!els.submit || !els.text || !els.gallery) return;

        els.submit.addEventListener('click', ()=>{
          const text = (els.text.value || '').trim();
          const name = (els.name && els.name.value || '').trim();
          if(!text){ announce('Please enter a takeaway before posting.'); return; }
          const items = load();
          items.push({ name, text, ts: Date.now() });
          save(items);
          els.text.value='';
          render();
          announce('Posted to the gallery.');
        });

        if(els.exporter){
          els.exporter.addEventListener('click', ()=>{
            const blob = new Blob([JSON.stringify(load(), null, 2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'student-voice.json';
            document.body.appendChild(a); a.click(); a.remove();
            setTimeout(()=> URL.revokeObjectURL(url), 2000);
            announce('Exported gallery as JSON.');
          });
        }

        render();
      }

      // Build when the Student Voice slide is active
      Reveal.on('slidechanged', e => { if(e.currentSlide && e.currentSlide.dataset.menu==='voice') wire(); });
      Reveal.on('ready', e => { if(e.currentSlide && e.currentSlide.dataset.menu==='voice') wire(); });
    })();
  </script>
</body>
</html>




    // ===== Student Voice & Artifacts (localStorage) =====
    (function(){
      const NAME = 'sv-name';
      const TEXT = 'sv-text';
      const SUBMIT = 'sv-submit';
      const EXPORT = 'sv-export';
      const GALLERY = 'sv-gallery';
      const LIVE = 'sv-live';
      const KEY = 'slides-sv-gallery';

      function getEls(){
        return {
          name: document.getElementById(NAME),
          text: document.getElementById(TEXT),
          submit: document.getElementById(SUBMIT),
          exporter: document.getElementById(EXPORT),
          gallery: document.getElementById(GALLERY),
          live: document.getElementById(LIVE)
        };
      }

      function load(){
        try{ return JSON.parse(localStorage.getItem(KEY) || '[]'); }
        catch(e){ return []; }
      }
      function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

      function cardHTML(item){
        const who = item.name && item.name.trim() ? item.name.trim() : 'Anonymous';
        const when = new Date(item.ts).toLocaleString();
        const txt = (item.text || '').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `<div style="border:1px solid #e5e7eb; border-radius:10px; padding:10px; background:#F9FAFB;">
                  <div style="font-weight:600;">${who}</div>
                  <div class="small-text" style="opacity:.8;">${when}</div>
                  <div style="margin-top:6px;">${txt}</div>
                </div>`;
      }

      function render(){
        const { gallery } = getEls(); if(!gallery) return;
        const items = load().slice().reverse();
        gallery.innerHTML = items.map(cardHTML).join('');
      }

      function announce(msg){ const { live } = getEls(); if(live) live.textContent = msg; }

      function wire(){
        const els = getEls();
        if(!els.submit || !els.text || !els.gallery) return;

        els.submit.addEventListener('click', ()=>{
          const text = (els.text.value || '').trim();
          const name = (els.name && els.name.value || '').trim();
          if(!text){ announce('Please enter a takeaway before posting.'); return; }
          const items = load();
          items.push({ name, text, ts: Date.now() });
          save(items);
          els.text.value='';
          render();
          announce('Posted to the gallery.');
        });

        if(els.exporter){
          els.exporter.addEventListener('click', ()=>{
            const blob = new Blob([JSON.stringify(load(), null, 2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'student-voice.json';
            document.body.appendChild(a); a.click(); a.remove();
            setTimeout(()=> URL.revokeObjectURL(url), 2000);
            announce('Exported gallery as JSON.');
          });
        }

        render();
      }

      // Build when the Student Voice slide is active
      Reveal.on('slidechanged', e => { if(e.currentSlide && e.currentSlide.dataset.menu==='voice') wire(); });
      Reveal.on('ready', e => { if(e.currentSlide && e.currentSlide.dataset.menu==='voice') wire(); });
    })();
