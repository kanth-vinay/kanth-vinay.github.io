<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Calculus Fluency Drill</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMcApdbeGqtLeQgm9zVubutJLUoCiXTeukDEZO9eACvRpj6si" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGqsACdealD+A" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .katex-display {
            margin: 0.5em 0;
        }
        .option-label {
            display: block;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .option-label:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        input[type="radio"]:checked + .option-label {
            background-color: #eef2ff;
            border-color: #6366f1;
            font-weight: 600;
            color: #4338ca;
        }
        input[type="radio"] {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-12">
    <div id="container" class="w-full max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-10 text-gray-800">

        <!-- Start Screen -->
        <div id="start-screen" class="text-center">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Pre-Calculus Fluency Drill</h1>
            <p class="text-gray-600 mb-6">This is a 15-minute, 15-question drill to test your recall of key concepts.</p>
            <p class="text-gray-600 mb-8">Topics: Logarithms, Polynomials, and Trig Identities.</p>
            <button id="start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300">
                Start Drill
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-2xl font-bold">Fluency Drill</h2>
                <div id="timer" class="text-2xl font-semibold bg-indigo-100 text-indigo-700 px-4 py-2 rounded-lg">15:00</div>
            </div>
            <form id="quiz-form"></form>
            <button id="submit-btn" class="mt-8 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300">
                Submit
            </button>
        </div>

        <!-- Scorecard Screen -->
        <div id="scorecard-screen" class="hidden">
            <div class="text-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold">Drill Complete!</h2>
                <p class="text-xl mt-2">Your Score: <span id="score" class="font-bold text-indigo-600"></span></p>
            </div>
            <div id="results-container" class="space-y-4"></div>
             <button id="restart-btn" class="mt-8 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300">
                Try Again
            </button>
        </div>

    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const scorecardScreen = document.getElementById('scorecard-screen');
        const startBtn = document.getElementById('start-btn');
        const submitBtn = document.getElementById('submit-btn');
        const restartBtn = document.getElementById('restart-btn');
        const quizForm = document.getElementById('quiz-form');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const resultsContainer = document.getElementById('results-container');

        const questions = [
            {
                question: "What is the value of $\\log_2(8)$?",
                options: ["3", "4", "16", "6"],
                correctAnswer: "3",
                topic: "Logarithms"
            },
            {
                question: "A polynomial of degree 3 can have at most how many real roots?",
                options: ["2", "3", "4", "Cannot be determined"],
                correctAnswer: "3",
                topic: "Polynomials"
            },
            {
                question: "Which of the following is a fundamental Pythagorean identity?",
                options: ["$\\sin(x) = \\cos(x)$", "$\\sin^2(x) + \\cos^2(x) = 1$", "$\\tan(x) = 1$", "$\\sin(x) + \\cos(x) = 1$"],
                correctAnswer: "$\\sin^2(x) + \\cos^2(x) = 1$",
                topic: "Trig Identities"
            },
            {
                question: "Rewrite $5^2 = 25$ in logarithmic form.",
                options: ["$\\log_5(25)=2$", "$\\log_2(25)=5$", "$\\log_5(2)=25$", "$\\log_{25}(5)=2$"],
                correctAnswer: "$\\log_5(25)=2$",
                topic: "Logarithms"
            },
            {
                question: "According to the Remainder Theorem, if a polynomial $P(x)$ is divided by $(x-a)$, what is the remainder?",
                options: ["$P(a)$", "$P(-a)$", "$a$", "$0$"],
                correctAnswer: "$P(a)$",
                topic: "Polynomials"
            },
            {
                question: "Which of the following is the Quotient Identity for $\\tan(x)$?",
                options: ["$\\sin(x)\\cos(x)$", "$\\frac{\\cos(x)}{\\sin(x)}$", "$\\frac{\\sin(x)}{\\cos(x)}$", "$\\frac{1}{\\sin(x)}$"],
                correctAnswer: "$\\frac{\\sin(x)}{\\cos(x)}$",
                topic: "Trig Identities"
            },
            {
                question: "Any logarithm with a base of 10, written as $\\log(x)$, is called a...",
                options: ["Natural Logarithm", "Common Logarithm", "Binary Logarithm", "Inverse Logarithm"],
                correctAnswer: "Common Logarithm",
                topic: "Logarithms"
            },
            {
                question: "Which expression is the Reciprocal Identity for $\\sec(x)$?",
                options: ["$\\frac{1}{\\cos(x)}$", "$\\frac{1}{\\sin(x)}$", "$\\frac{1}{\\tan(x)}$", "$\\cos(x)$"],
                correctAnswer: "$\\frac{1}{\\cos(x)}$",
                topic: "Trig Identities"
            },
            {
                question: "If using synthetic division to divide a polynomial by $(x+4)$, what number is placed in the top-left box?",
                options: ["4", "1", "-4", "0"],
                correctAnswer: "-4",
                topic: "Synthetic Division"
            },
            {
                question: "The expression $\\ln(x)$ represents a logarithm with what base?",
                options: ["10", "2", "No Base", "$e$"],
                correctAnswer: "$e$",
                topic: "Logarithms"
            },
            {
                question: "The Power Rule of logarithms states that $\\log(x^a)$ is equivalent to...",
                options: ["$x \\log(a)$", "$a + \\log(x)$", "$a \\log(x)$", "$\\log(a) + \\log(x)$"],
                correctAnswer: "$a \\log(x)$",
                topic: "Logarithms"
            },
            {
                question: "If $(x-c)$ is a factor of a polynomial $P(x)$, then what is the value of $P(c)$?",
                options: ["c", "-c", "1", "0"],
                correctAnswer: "0",
                topic: "Polynomials"
            },
             { // CHALLENGE QUESTION 1
                question: "Simplify the expression: $\\frac{1 - \\cos^2(x)}{\\sin(x)\\cos(x)}$",
                options: ["$\\tan(x)$", "$\\cot(x)$", "$\\sin(x)$", "1"],
                correctAnswer: "$\\tan(x)$",
                topic: "Trig Identities"
            },
            { // CHALLENGE QUESTION 2
                question: "If $\\cos(\\theta) = \\frac{3}{5}$ and $\\theta$ is in Quadrant IV, what is the value of $\\sin(\\theta)$?",
                options: ["$\\frac{4}{5}$", "$-\\frac{4}{5}$", "$\\frac{5}{3}$", "$-\\frac{3}{5}$"],
                correctAnswer: "$-\\frac{4}{5}$",
                topic: "Trig Identities"
            },
            {
                question: "Complete the Pythagorean identity: $1 + \\cot^2(x) = \\text{?}$",
                options: ["$\\csc^2(x)$", "$\\sec^2(x)$", "$\\tan^2(x)$", "1"],
                correctAnswer: "$\\csc^2(x)$",
                topic: "Trig Identities"
            }
        ];

        let timer;
        let timeLeft = 900;

        const katexOptions = {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            throwOnError : false
        };

        function startDrill() {
            startScreen.classList.add('hidden');
            scorecardScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            displayQuestions();
            startTimer();
        }

        function startTimer() {
            timeLeft = 900;
            timerDisplay.textContent = "15:00";
            timer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    submitDrill();
                }
            }, 1000);
        }

        function displayQuestions() {
            quizForm.innerHTML = '';
            // Shuffle questions to make it interesting, keeping challenge questions in the mix
            const shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);

            shuffledQuestions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.classList.add('mb-8');
                questionElement.dataset.originalIndex = questions.indexOf(q); // Keep track of original question

                const questionText = `<div class="block text-lg font-medium text-gray-700 mb-4">${index + 1}. ${q.question}</div>`;
                
                const optionsHTML = q.options.map((option, optIndex) => `
                    <div>
                        <input type="radio" id="q${index}_opt${optIndex}" name="q${index}" value="${option}">
                        <label for="q${index}_opt${optIndex}" class="option-label">${option}</label>
                    </div>
                `).join('');

                questionElement.innerHTML = `
                    ${questionText}
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${optionsHTML}
                    </div>
                `;
                quizForm.appendChild(questionElement);
            });
            renderMathInElement(quizForm, katexOptions);
        }

        function submitDrill(event) {
            if(event) event.preventDefault();
            clearInterval(timer);

            let score = 0;
            const results = [];
            
            const displayedQuestions = quizForm.querySelectorAll('.mb-8');

            displayedQuestions.forEach((questionEl, index) => {
                const originalIndex = parseInt(questionEl.dataset.originalIndex, 10);
                const q = questions[originalIndex];

                const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                const userAnswer = selectedOption ? selectedOption.value : "No Answer";
                const isCorrect = userAnswer === q.correctAnswer;
                
                if (isCorrect) score++;

                results.push({
                    question: q.question,
                    userAnswer: userAnswer,
                    correctAnswer: q.correctAnswer,
                    isCorrect: isCorrect
                });
            });
            showScorecard(score, results);
        }
        
        function showScorecard(score, results){
            quizScreen.classList.add('hidden');
            scorecardScreen.classList.remove('hidden');
            scoreDisplay.textContent = `${score} / ${questions.length}`;
            resultsContainer.innerHTML = '';

            results.forEach((result, index) => {
                const resultElement = document.createElement('div');
                resultElement.classList.add('p-4', 'rounded-lg', 'border');
                const colorClass = result.isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
                resultElement.classList.add(...colorClass.split(' '));

                resultElement.innerHTML = `
                    <p class="font-semibold text-gray-800">${index + 1}. ${result.question}</p>
                    <p class="text-sm mt-2">Your Answer: <span class="font-medium ${result.isCorrect ? 'text-green-700' : 'text-red-700'}">${result.userAnswer}</span></p>
                    ${!result.isCorrect ? `<p class="text-sm">Correct Answer: <span class="font-medium text-green-700">${result.correctAnswer}</span></p>` : ''}
                `;
                resultsContainer.appendChild(resultElement);
            });
            renderMathInElement(resultsContainer, katexOptions);
        }
        
        function restartDrill() {
            startDrill();
        }

        startBtn.addEventListener('click', startDrill);
        quizForm.addEventListener('submit', submitDrill);
        submitBtn.addEventListener('click', submitDrill);
        restartBtn.addEventListener('click', restartDrill);

    </script>
</body>
</html>
